<!DOCTYPE html>
<!-- Generated by Cython 0.29.21 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: find_cutpoints.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
pre { line-height: 125%; margin: 0; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.cython .hll { background-color: #ffffcc }
.cython { background: #f8f8f8; }
.cython .c { color: #408080; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #BC7A00 } /* Comment.Preproc */
.cython .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #408080; font-style: italic } /* Comment.Single */
.cython .cs { color: #408080; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .gr { color: #FF0000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #00A000 } /* Generic.Inserted */
.cython .go { color: #888888 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #7D9029 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #999999; font-weight: bold } /* Name.Entity */
.cython .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #A0A000 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #BB6688 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.21</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="find_cutpoints.c">find_cutpoints.c</a></p>
<div class="cython"><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: <span class="c"># -*- coding: utf-8 -*-</span></pre>
<pre class='cython code score-13 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_kp_u_find_cutpoints_line_52, __pyx_kp_u_Compute_the_cutpoints_from_a_giv) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: <span class="c">#    pept is a Python library that unifies Positron Emission Particle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: <span class="c">#    Tracking (PEPT) research, including tracking, simulation, data analysis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: <span class="c">#    and visualisation tools.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: <span class="c">#    If you used this codebase or any software making use of it in a scientific</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: <span class="c">#    publication, you must cite the following paper:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: <span class="c">#        Nicuşan AL, Windows-Yule CR. Positron emission particle tracking</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: <span class="c">#        using machine learning. Review of Scientific Instruments.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: <span class="c">#        2020 Jan 1;91(1):013329.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: <span class="c">#        https://doi.org/10.1063/1.5129251</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: <span class="c">#    Copyright (C) 2020 Andrei Leonard Nicusan</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: <span class="c">#    This program is free software: you can redistribute it and/or modify</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: <span class="c">#    it under the terms of the GNU General Public License as published by</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: <span class="c">#    the Free Software Foundation, either version 3 of the License, or</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: <span class="c">#    (at your option) any later version.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: <span class="c">#    This program is distributed in the hope that it will be useful,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: <span class="c">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: <span class="c">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: <span class="c">#    GNU General Public License for more details.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: <span class="c">#    You should have received a copy of the GNU General Public License</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: <span class="c">#    along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: <span class="c">#    pept is a Python library that unifies Positron Emission Particle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: <span class="c">#    Tracking (PEPT) research, including tracking, simulation, data analysis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: <span class="c">#    and visualisation tools</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: <span class="c"># File              : find_cutpoints.pyx</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: <span class="c"># License           : License: GNU v3.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: <span class="c"># Author            : Andrei Leonard Nicusan &lt;a.l.nicusan@bham.ac.uk&gt;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: <span class="c"># Date              : 03.02.2019</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: <span class="c"># cython: language_level=3</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: <span class="c"># cython: boundscheck=False</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: <span class="c"># cython: wraparound=False</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: <span class="c"># cython: initializedcheck=False</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: <span class="c"># cython: nonecheck=False</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: <span class="c"># cython: embedsignature=True</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: <span class="c"># cython: cdivision=True</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">049</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 49, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: </pre>
<pre class="cython line score-68" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">052</span>: <span class="k">cpdef</span> <span class="nf">find_cutpoints</span><span class="p">(</span></pre>
<pre class='cython code score-68 '>static PyObject *__pyx_pw_4pept_9utilities_9cutpoints_14find_cutpoints_1find_cutpoints(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_4pept_9utilities_9cutpoints_14find_cutpoints_find_cutpoints(__Pyx_memviewslice __pyx_v_sample_lines, double __pyx_v_max_distance, __Pyx_memviewslice __pyx_v_cutoffs, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_4pept_9utilities_9cutpoints_14find_cutpoints_find_cutpoints *__pyx_optional_args) {
  int __pyx_v_append_indices = ((int)0);
  Py_ssize_t __pyx_v_n;
  PyObject *__pyx_v_cutpoints = NULL;
  __Pyx_memviewslice __pyx_v_cutpoints_mv = { 0, 0, { 0 }, { 0 }, { 0 } };
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
  Py_ssize_t __pyx_v_k;
  Py_ssize_t __pyx_v_ic;
  double __pyx_v_P[3];
  double __pyx_v_U[3];
  double __pyx_v_Q[3];
  double __pyx_v_R[3];
  double __pyx_v_QP[3];
  double __pyx_v_a;
  double __pyx_v_b;
  double __pyx_v_c;
  double __pyx_v_d;
  double __pyx_v_e;
  double __pyx_v_denom;
  double __pyx_v_s0;
  double __pyx_v_t0;
  double __pyx_v_A0[3];
  double __pyx_v_C0[3];
  double __pyx_v_AC0[3];
  double __pyx_v_mx;
  double __pyx_v_my;
  double __pyx_v_mz;
  PyObject *__pyx_v_cutpoints_truncated = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("find_cutpoints", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_append_indices = __pyx_optional_args-&gt;append_indices;
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pept.utilities.cutpoints.find_cutpoints.find_cutpoints", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_cutpoints);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_cutpoints_mv, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_cutpoints_truncated);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_4pept_9utilities_9cutpoints_14find_cutpoints_1find_cutpoints(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4pept_9utilities_9cutpoints_14find_cutpoints_find_cutpoints[] = "find_cutpoints(double[:, :] sample_lines, double max_distance, double[:] cutoffs, bool append_indices=0)\nCompute the cutpoints from a given array of lines.\n\n    ::\n\n        Function signature:\n            find_cutpoints(\n                double[:, :] sample_lines,  # LoRs in sample\n                double max_distance,        # Max distance between two LoRs\n                double[:] cutoffs,          # Spatial cutoff for cutpoints\n                bint append_indices = False # Append LoR indices used\n            )\n\n    This is a low-level Cython function that does not do any checks on the\n    input data - it is meant to be used in other modules / libraries. For a\n    normal user, the `pept.tracking.peptml` function `find_cutpoints` and\n    class `Cutpoints` are recommended as higher-level APIs. They do check the\n    input data and are easier to use (for example, they automatically compute\n    the cutoffs).\n\n    A cutpoint is the point in 3D space that minimises the distance between any\n    two lines. For any two non-parallel 3D lines, this point corresponds to the\n    midpoint of the unique segment that is perpendicular to both lines.\n\n    This function considers every pair of lines in `sample_lines` and returns\n    all the cutpoints that satisfy the following conditions:\n\n    1. The distance between the two lines is smaller than `max_distance`.\n    2. The cutpoints are within the `cutoffs`.\n\n    Parameters\n    ----------\n    sample_lines : (N, M &gt;= 7) numpy.ndarray\n        The sample of lines, where each row is [time, x1, y1, z1, x2, y2, z2],\n        containing two points [x1, y1, z1] and [x2, y2, z2] defining an LoR.\n    max_distance : float\n        The maximum distance between two LoRs for their cutpoint to be\n        considered.\n    cutoffs : (6,) numpy.ndarray\n        Only consider the cutpoints that fall within the cutoffs. `cutoffs` has\n        the format [min_x, max_x, min_y, max_y, min_z, max_z].\n    append_indices : bo""ol, optional\n        If set to `True`, the indices of the individual LoRs that were used\n        to compute each cutpoint is also appended to the returned array.\n        Default is `False`.\n\n    Returns\n    -------\n    cutpoints : (M, 4) or (M, 6) numpy.ndarray\n        A numpy array of the calculated weighted cutpoints. If `append_indices`\n        is `False`, then the columns are [time, x, y, z]. If `append_indices`\n        is `True`, then the columns are [time, x, y, z, i, j], where `i` and\n        `j` are the LoR indices from `sample_lines` that were used to compute\n        the cutpoints. The time is the average between the timestamps of the\n        two LoRs that were used to compute the cutpoint. The first column (for\n        time) is sorted.\n\n    Examples\n    --------\n\n    &gt;&gt;&gt; import numpy as np\n    &gt;&gt;&gt; from pept.utilities import find_cutpoints\n    &gt;&gt;&gt;\n    &gt;&gt;&gt; lines = np.random.random((500, 7)) * 500\n    &gt;&gt;&gt; max_distance = 0.1\n    &gt;&gt;&gt; cutoffs = np.array([0, 500, 0, 500, 0, 500], dtype = float)\n    &gt;&gt;&gt;\n    &gt;&gt;&gt; cutpoints = find_cutpoints(lines, max_distance, cutoffs)\n\n    ";
static PyObject *__pyx_pw_4pept_9utilities_9cutpoints_14find_cutpoints_1find_cutpoints(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_sample_lines = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_max_distance;
  __Pyx_memviewslice __pyx_v_cutoffs = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_append_indices;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("find_cutpoints (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_sample_lines,&amp;__pyx_n_s_max_distance,&amp;__pyx_n_s_cutoffs,&amp;__pyx_n_s_append_indices,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sample_lines)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_max_distance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_cutpoints", 0, 3, 4, 1); <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cutoffs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_cutpoints", 0, 3, 4, 2); <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_append_indices);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "find_cutpoints") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_sample_lines = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_sample_lines.memview)) __PYX_ERR(0, 53, __pyx_L3_error)</span>
    __pyx_v_max_distance = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_max_distance == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L3_error)</span>
    __pyx_v_cutoffs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_cutoffs.memview)) __PYX_ERR(0, 55, __pyx_L3_error)</span>
    if (values[3]) {
      __pyx_v_append_indices = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[3]); if (unlikely((__pyx_v_append_indices == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 56, __pyx_L3_error)</span>
    } else {
      __pyx_v_append_indices = ((int)0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_cutpoints", 0, 3, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pept.utilities.cutpoints.find_cutpoints.find_cutpoints", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4pept_9utilities_9cutpoints_14find_cutpoints_find_cutpoints(__pyx_self, __pyx_v_sample_lines, __pyx_v_max_distance, __pyx_v_cutoffs, __pyx_v_append_indices);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4pept_9utilities_9cutpoints_14find_cutpoints_find_cutpoints(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_sample_lines, double __pyx_v_max_distance, __Pyx_memviewslice __pyx_v_cutoffs, int __pyx_v_append_indices) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("find_cutpoints", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.append_indices = __pyx_v_append_indices;
  __pyx_t_1 = __pyx_f_4pept_9utilities_9cutpoints_14find_cutpoints_find_cutpoints(__pyx_v_sample_lines, __pyx_v_max_distance, __pyx_v_cutoffs, 0, &amp;__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 52, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("pept.utilities.cutpoints.find_cutpoints.find_cutpoints", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_sample_lines, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_cutoffs, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">053</span>:     <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">sample_lines</span><span class="p">,</span>  <span class="c"># LoRs in sample</span></pre>
<pre class='cython code score-0 '>struct __pyx_opt_args_4pept_9utilities_9cutpoints_14find_cutpoints_find_cutpoints {
  int __pyx_n;
  int append_indices;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">054</span>:     <span class="n">double</span> <span class="n">max_distance</span><span class="p">,</span>        <span class="c"># Max allowed distance between two LoRs</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>:     <span class="n">double</span><span class="p">[:]</span> <span class="n">cutoffs</span><span class="p">,</span>          <span class="c"># Spatial cutoff for cutpoints</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>:     <span class="n">bint</span> <span class="n">append_indices</span> <span class="o">=</span> <span class="mf">0</span>     <span class="c"># Append LoR indices used for each cutpoint</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>: <span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>:     <span class="sd">&#39;&#39;&#39;Compute the cutpoints from a given array of lines.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>: <span class="sd">    ::</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>: <span class="sd">        Function signature:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>: <span class="sd">            find_cutpoints(</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>: <span class="sd">                double[:, :] sample_lines,  # LoRs in sample</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>: <span class="sd">                double max_distance,        # Max distance between two LoRs</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>: <span class="sd">                double[:] cutoffs,          # Spatial cutoff for cutpoints</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>: <span class="sd">                bint append_indices = False # Append LoR indices used</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>: <span class="sd">            )</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>: <span class="sd">    This is a low-level Cython function that does not do any checks on the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>: <span class="sd">    input data - it is meant to be used in other modules / libraries. For a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>: <span class="sd">    normal user, the `pept.tracking.peptml` function `find_cutpoints` and</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>: <span class="sd">    class `Cutpoints` are recommended as higher-level APIs. They do check the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>: <span class="sd">    input data and are easier to use (for example, they automatically compute</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>: <span class="sd">    the cutoffs).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>: <span class="sd">    A cutpoint is the point in 3D space that minimises the distance between any</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>: <span class="sd">    two lines. For any two non-parallel 3D lines, this point corresponds to the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>: <span class="sd">    midpoint of the unique segment that is perpendicular to both lines.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>: <span class="sd">    This function considers every pair of lines in `sample_lines` and returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>: <span class="sd">    all the cutpoints that satisfy the following conditions:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>: <span class="sd">    1. The distance between the two lines is smaller than `max_distance`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>: <span class="sd">    2. The cutpoints are within the `cutoffs`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>: <span class="sd">    sample_lines : (N, M &gt;= 7) numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>: <span class="sd">        The sample of lines, where each row is [time, x1, y1, z1, x2, y2, z2],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>: <span class="sd">        containing two points [x1, y1, z1] and [x2, y2, z2] defining an LoR.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">092</span>: <span class="sd">    max_distance : float</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>: <span class="sd">        The maximum distance between two LoRs for their cutpoint to be</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>: <span class="sd">        considered.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">095</span>: <span class="sd">    cutoffs : (6,) numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">096</span>: <span class="sd">        Only consider the cutpoints that fall within the cutoffs. `cutoffs` has</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">097</span>: <span class="sd">        the format [min_x, max_x, min_y, max_y, min_z, max_z].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">098</span>: <span class="sd">    append_indices : bool, optional</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">099</span>: <span class="sd">        If set to `True`, the indices of the individual LoRs that were used</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">100</span>: <span class="sd">        to compute each cutpoint is also appended to the returned array.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">101</span>: <span class="sd">        Default is `False`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>: <span class="sd">    Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>: <span class="sd">    -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">105</span>: <span class="sd">    cutpoints : (M, 4) or (M, 6) numpy.ndarray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>: <span class="sd">        A numpy array of the calculated weighted cutpoints. If `append_indices`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>: <span class="sd">        is `False`, then the columns are [time, x, y, z]. If `append_indices`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>: <span class="sd">        is `True`, then the columns are [time, x, y, z, i, j], where `i` and</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>: <span class="sd">        `j` are the LoR indices from `sample_lines` that were used to compute</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>: <span class="sd">        the cutpoints. The time is the average between the timestamps of the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>: <span class="sd">        two LoRs that were used to compute the cutpoint. The first column (for</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>: <span class="sd">        time) is sorted.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>: <span class="sd">    Examples</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>: <span class="sd">    --------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>: <span class="sd">    &gt;&gt;&gt; import numpy as np</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>: <span class="sd">    &gt;&gt;&gt; from pept.utilities import find_cutpoints</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>: <span class="sd">    &gt;&gt;&gt;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>: <span class="sd">    &gt;&gt;&gt; lines = np.random.random((500, 7)) * 500</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>: <span class="sd">    &gt;&gt;&gt; max_distance = 0.1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>: <span class="sd">    &gt;&gt;&gt; cutoffs = np.array([0, 500, 0, 500, 0, 500], dtype = float)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>: <span class="sd">    &gt;&gt;&gt;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>: <span class="sd">    &gt;&gt;&gt; cutpoints = find_cutpoints(lines, max_distance, cutoffs)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>: <span class="sd">    &#39;&#39;&#39;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>:     <span class="c"># Lines for a single sample =&gt; n x 7 array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>:     <span class="c"># sample_lines row: [time X1 Y1 Z1 X2 Y2 Z2]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">130</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">n</span> <span class="o">=</span> <span class="n">sample_lines</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_n = (__pyx_v_sample_lines.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">131</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>:     <span class="c"># Pre-allocate enough memory</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>:     <span class="c"># weighted_cutpoints cols: [time, x, y, z, [LoR1_index, LoR2_index]]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">134</span>:     <span class="k">if</span> <span class="n">append_indices</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_append_indices != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">135</span>:         <span class="n">cutpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">//</span> <span class="mf">2</span><span class="p">,</span> <span class="mf">6</span><span class="p">),</span> <span class="n">order</span> <span class="o">=</span> <span class="s">&#39;C&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-36 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(((__pyx_v_n * (__pyx_v_n - 1)) / 2));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_6);
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_order, __pyx_n_u_C) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 135, __pyx_L1_error)</span>
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 135, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_cutpoints = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">136</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">137</span>:         <span class="n">cutpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">//</span> <span class="mf">2</span><span class="p">,</span> <span class="mf">4</span><span class="p">),</span> <span class="n">order</span> <span class="o">=</span> <span class="s">&#39;C&#39;</span><span class="p">)</span></pre>
<pre class='cython code score-36 '>  /*else*/ {
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyInt_FromSsize_t</span>(((__pyx_v_n * (__pyx_v_n - 1)) / 2));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_int_4);
    __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_n_s_order, __pyx_n_u_C) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 137, __pyx_L1_error)</span>
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_5, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_cutpoints = __pyx_t_3;
    __pyx_t_3 = 0;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">138</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>:     <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:,</span> <span class="p">:]</span> <span class="n">cutpoints_mv</span> <span class="o">=</span> <span class="n">cutpoints</span>  <span class="c"># memoryview of cutpoints</span></pre>
<pre class='cython code score-2 '>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_cutpoints, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  __pyx_v_cutpoints_mv = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">141</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">k</span>                     <span class="c"># iterators</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>:     <span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">ic</span>                          <span class="c"># cutpoint index</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:     <span class="k">cdef</span> <span class="kt">double</span>[3] <span class="nf">P</span><span class="p">,</span> <span class="nf">U</span><span class="p">,</span> <span class="nf">Q</span><span class="p">,</span> <span class="nf">R</span><span class="p">,</span> <span class="nf">QP</span>               <span class="c"># position, direction vectors</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">a</span><span class="p">,</span> <span class="nf">b</span><span class="p">,</span> <span class="nf">c</span><span class="p">,</span> <span class="nf">d</span><span class="p">,</span> <span class="nf">e</span>                   <span class="c"># collected terms</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">denom</span><span class="p">,</span> <span class="nf">s0</span><span class="p">,</span> <span class="nf">t0</span>                   <span class="c"># parameters for lines</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>:     <span class="k">cdef</span> <span class="kt">double</span>[3] <span class="nf">A0</span><span class="p">,</span> <span class="nf">C0</span><span class="p">,</span> <span class="nf">AC0</span>                  <span class="c"># perpendicular points</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">mx</span><span class="p">,</span> <span class="nf">my</span><span class="p">,</span> <span class="nf">mz</span>                      <span class="c"># cutpoint coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">149</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-4 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L6;
        }
        __pyx_L6:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">150</span>:         <span class="n">ic</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_ic = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">151</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        __pyx_t_7 = (__pyx_v_n - 1);
        __pyx_t_8 = __pyx_t_7;
        for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
          __pyx_v_i = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">152</span>:             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>          __pyx_t_10 = __pyx_v_n;
          __pyx_t_11 = __pyx_t_10;
          for (__pyx_t_12 = (__pyx_v_i + 1); __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
            __pyx_v_j = __pyx_t_12;
</pre><pre class="cython line score-0">&#xA0;<span class="">153</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">154</span>:                 <span class="c"># Write each pair of lines in terms of a position vector and a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">155</span>:                 <span class="c"># direction vector:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>:                 <span class="c"># L1 : A(s) = P + s U</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>:                 <span class="c"># L2 : C(t) = Q + t R</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">158</span>:                 <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>            for (__pyx_t_13 = 0; __pyx_t_13 &lt; 3; __pyx_t_13+=1) {
              __pyx_v_k = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">159</span>:                     <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_lines</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              __pyx_t_14 = __pyx_v_i;
              __pyx_t_15 = (1 + __pyx_v_k);
              (__pyx_v_P[__pyx_v_k]) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sample_lines.data + __pyx_t_14 * __pyx_v_sample_lines.strides[0]) ) + __pyx_t_15 * __pyx_v_sample_lines.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">160</span>:                     <span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_lines</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">4</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              __pyx_t_15 = __pyx_v_i;
              __pyx_t_14 = (4 + __pyx_v_k);
              (__pyx_v_U[__pyx_v_k]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sample_lines.data + __pyx_t_15 * __pyx_v_sample_lines.strides[0]) ) + __pyx_t_14 * __pyx_v_sample_lines.strides[1]) ))) - (__pyx_v_P[__pyx_v_k]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">161</span>:                     <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_lines</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              __pyx_t_14 = __pyx_v_j;
              __pyx_t_15 = (1 + __pyx_v_k);
              (__pyx_v_Q[__pyx_v_k]) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sample_lines.data + __pyx_t_14 * __pyx_v_sample_lines.strides[0]) ) + __pyx_t_15 * __pyx_v_sample_lines.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">162</span>:                     <span class="n">R</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_lines</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">4</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              __pyx_t_15 = __pyx_v_j;
              __pyx_t_14 = (4 + __pyx_v_k);
              (__pyx_v_R[__pyx_v_k]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sample_lines.data + __pyx_t_15 * __pyx_v_sample_lines.strides[0]) ) + __pyx_t_14 * __pyx_v_sample_lines.strides[1]) ))) - (__pyx_v_Q[__pyx_v_k]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">163</span>:                     <span class="n">QP</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              (__pyx_v_QP[__pyx_v_k]) = ((__pyx_v_Q[__pyx_v_k]) - (__pyx_v_P[__pyx_v_k]));
            }
</pre><pre class="cython line score-0">&#xA0;<span class="">164</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">165</span>:                 <span class="n">a</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">U</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">U</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            __pyx_v_a = ((((__pyx_v_U[0]) * (__pyx_v_U[0])) + ((__pyx_v_U[1]) * (__pyx_v_U[1]))) + ((__pyx_v_U[2]) * (__pyx_v_U[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">166</span>:                 <span class="n">b</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">U</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">U</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            __pyx_v_b = ((((__pyx_v_U[0]) * (__pyx_v_R[0])) + ((__pyx_v_U[1]) * (__pyx_v_R[1]))) + ((__pyx_v_U[2]) * (__pyx_v_R[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>:                 <span class="n">c</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            __pyx_v_c = ((((__pyx_v_R[0]) * (__pyx_v_R[0])) + ((__pyx_v_R[1]) * (__pyx_v_R[1]))) + ((__pyx_v_R[2]) * (__pyx_v_R[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>:                 <span class="n">d</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">QP</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">U</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">QP</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">U</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">QP</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            __pyx_v_d = ((((__pyx_v_U[0]) * (__pyx_v_QP[0])) + ((__pyx_v_U[1]) * (__pyx_v_QP[1]))) + ((__pyx_v_U[2]) * (__pyx_v_QP[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>:                 <span class="n">e</span> <span class="o">=</span> <span class="n">QP</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">QP</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">QP</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            __pyx_v_e = ((((__pyx_v_QP[0]) * (__pyx_v_R[0])) + ((__pyx_v_QP[1]) * (__pyx_v_R[1]))) + ((__pyx_v_QP[2]) * (__pyx_v_R[2])));
</pre><pre class="cython line score-0">&#xA0;<span class="">170</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">171</span>:                 <span class="n">denom</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span></pre>
<pre class='cython code score-0 '>            __pyx_v_denom = ((__pyx_v_b * __pyx_v_b) - (__pyx_v_a * __pyx_v_c));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>:                 <span class="k">if</span> <span class="n">denom</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            __pyx_t_1 = (__pyx_v_denom != 0);
            if (__pyx_t_1) {
/* … */
            }
          }
        }
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">173</span>:                     <span class="n">s0</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">e</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span></pre>
<pre class='cython code score-0 '>              __pyx_v_s0 = (((__pyx_v_b * __pyx_v_e) - (__pyx_v_c * __pyx_v_d)) / __pyx_v_denom);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">174</span>:                     <span class="n">t0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">e</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span></pre>
<pre class='cython code score-0 '>              __pyx_v_t0 = (((__pyx_v_a * __pyx_v_e) - (__pyx_v_b * __pyx_v_d)) / __pyx_v_denom);
</pre><pre class="cython line score-0">&#xA0;<span class="">175</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">176</span>:                     <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>              for (__pyx_t_13 = 0; __pyx_t_13 &lt; 3; __pyx_t_13+=1) {
                __pyx_v_k = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">177</span>:                         <span class="n">A0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">s0</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                (__pyx_v_A0[__pyx_v_k]) = ((__pyx_v_P[__pyx_v_k]) + (__pyx_v_s0 * (__pyx_v_U[__pyx_v_k])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">178</span>:                         <span class="n">C0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">t0</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                (__pyx_v_C0[__pyx_v_k]) = ((__pyx_v_Q[__pyx_v_k]) + (__pyx_v_t0 * (__pyx_v_R[__pyx_v_k])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">179</span>:                         <span class="n">AC0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">A0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">C0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                (__pyx_v_AC0[__pyx_v_k]) = ((__pyx_v_A0[__pyx_v_k]) - (__pyx_v_C0[__pyx_v_k]));
              }
</pre><pre class="cython line score-0">&#xA0;<span class="">180</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>:                     <span class="c"># Check the distance is smaller than max_distance</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">182</span>:                     <span class="k">if</span> <span class="p">(</span><span class="n">AC0</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">AC0</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">AC0</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">AC0</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span></pre>
<pre class='cython code score-0 '>              if (__pyx_t_1) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">183</span>:                         <span class="n">AC0</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">AC0</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_distance</span> <span class="o">*</span> <span class="n">max_distance</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>              __pyx_t_1 = ((((((__pyx_v_AC0[0]) * (__pyx_v_AC0[0])) + ((__pyx_v_AC0[1]) * (__pyx_v_AC0[1]))) + ((__pyx_v_AC0[2]) * (__pyx_v_AC0[2]))) &lt; (__pyx_v_max_distance * __pyx_v_max_distance)) != 0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">184</span>:                         <span class="n">mx</span> <span class="o">=</span> <span class="p">(</span><span class="n">A0</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">C0</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>                __pyx_v_mx = (((__pyx_v_A0[0]) + (__pyx_v_C0[0])) / 2.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">185</span>:                         <span class="n">my</span> <span class="o">=</span> <span class="p">(</span><span class="n">A0</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">C0</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>                __pyx_v_my = (((__pyx_v_A0[1]) + (__pyx_v_C0[1])) / 2.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">186</span>:                         <span class="n">mz</span> <span class="o">=</span> <span class="p">(</span><span class="n">A0</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">C0</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>                __pyx_v_mz = (((__pyx_v_A0[2]) + (__pyx_v_C0[2])) / 2.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">187</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">188</span>:                         <span class="c"># Check the cutpoint falls within the cutoffs</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">189</span>:                         <span class="k">if</span> <span class="p">(</span><span class="n">mx</span> <span class="o">&gt;</span> <span class="n">cutoffs</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">mx</span> <span class="o">&lt;</span> <span class="n">cutoffs</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>                __pyx_t_14 = 0;
                __pyx_t_16 = ((__pyx_v_mx &gt; (*((double *) ( /* dim=0 */ (__pyx_v_cutoffs.data + __pyx_t_14 * __pyx_v_cutoffs.strides[0]) )))) != 0);
                if (__pyx_t_16) {
                } else {
                  __pyx_t_1 = __pyx_t_16;
                  goto __pyx_L18_bool_binop_done;
                }
                __pyx_t_14 = 1;
                __pyx_t_16 = ((__pyx_v_mx &lt; (*((double *) ( /* dim=0 */ (__pyx_v_cutoffs.data + __pyx_t_14 * __pyx_v_cutoffs.strides[0]) )))) != 0);
                if (__pyx_t_16) {
                } else {
                  __pyx_t_1 = __pyx_t_16;
                  goto __pyx_L18_bool_binop_done;
                }
/* … */
                if (__pyx_t_1) {
/* … */
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">190</span>:                             <span class="n">my</span> <span class="o">&gt;</span> <span class="n">cutoffs</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">my</span> <span class="o">&lt;</span> <span class="n">cutoffs</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>                __pyx_t_14 = 2;
                __pyx_t_16 = ((__pyx_v_my &gt; (*((double *) ( /* dim=0 */ (__pyx_v_cutoffs.data + __pyx_t_14 * __pyx_v_cutoffs.strides[0]) )))) != 0);
                if (__pyx_t_16) {
                } else {
                  __pyx_t_1 = __pyx_t_16;
                  goto __pyx_L18_bool_binop_done;
                }
                __pyx_t_14 = 3;
                __pyx_t_16 = ((__pyx_v_my &lt; (*((double *) ( /* dim=0 */ (__pyx_v_cutoffs.data + __pyx_t_14 * __pyx_v_cutoffs.strides[0]) )))) != 0);
                if (__pyx_t_16) {
                } else {
                  __pyx_t_1 = __pyx_t_16;
                  goto __pyx_L18_bool_binop_done;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">191</span>:                             <span class="n">mz</span> <span class="o">&gt;</span> <span class="n">cutoffs</span><span class="p">[</span><span class="mf">4</span><span class="p">]</span> <span class="ow">and</span> <span class="n">mz</span> <span class="o">&lt;</span> <span class="n">cutoffs</span><span class="p">[</span><span class="mf">5</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>                __pyx_t_14 = 4;
                __pyx_t_16 = ((__pyx_v_mz &gt; (*((double *) ( /* dim=0 */ (__pyx_v_cutoffs.data + __pyx_t_14 * __pyx_v_cutoffs.strides[0]) )))) != 0);
                if (__pyx_t_16) {
                } else {
                  __pyx_t_1 = __pyx_t_16;
                  goto __pyx_L18_bool_binop_done;
                }
                __pyx_t_14 = 5;
                __pyx_t_16 = ((__pyx_v_mz &lt; (*((double *) ( /* dim=0 */ (__pyx_v_cutoffs.data + __pyx_t_14 * __pyx_v_cutoffs.strides[0]) )))) != 0);
                __pyx_t_1 = __pyx_t_16;
                __pyx_L18_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">192</span>:                             <span class="c"># Average the times of the two lines</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">193</span>:                             <span class="n">cutpoints_mv</span><span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample_lines</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>                  __pyx_t_14 = __pyx_v_i;
                  __pyx_t_15 = 0;
/* … */
                  __pyx_t_19 = __pyx_v_ic;
                  __pyx_t_20 = 0;
                  *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_cutpoints_mv.data + __pyx_t_19 * __pyx_v_cutpoints_mv.strides[0]) ) + __pyx_t_20 * __pyx_v_cutpoints_mv.strides[1]) )) = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sample_lines.data + __pyx_t_14 * __pyx_v_sample_lines.strides[0]) ) + __pyx_t_15 * __pyx_v_sample_lines.strides[1]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sample_lines.data + __pyx_t_17 * __pyx_v_sample_lines.strides[0]) ) + __pyx_t_18 * __pyx_v_sample_lines.strides[1]) )))) / 2.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">194</span>:                                                    <span class="n">sample_lines</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>                  __pyx_t_17 = __pyx_v_j;
                  __pyx_t_18 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:                             <span class="n">cutpoints_mv</span><span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mx</span></pre>
<pre class='cython code score-0 '>                  __pyx_t_18 = __pyx_v_ic;
                  __pyx_t_17 = 1;
                  *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_cutpoints_mv.data + __pyx_t_18 * __pyx_v_cutpoints_mv.strides[0]) ) + __pyx_t_17 * __pyx_v_cutpoints_mv.strides[1]) )) = __pyx_v_mx;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:                             <span class="n">cutpoints_mv</span><span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">my</span></pre>
<pre class='cython code score-0 '>                  __pyx_t_17 = __pyx_v_ic;
                  __pyx_t_18 = 2;
                  *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_cutpoints_mv.data + __pyx_t_17 * __pyx_v_cutpoints_mv.strides[0]) ) + __pyx_t_18 * __pyx_v_cutpoints_mv.strides[1]) )) = __pyx_v_my;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:                             <span class="n">cutpoints_mv</span><span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">mz</span></pre>
<pre class='cython code score-0 '>                  __pyx_t_18 = __pyx_v_ic;
                  __pyx_t_17 = 3;
                  *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_cutpoints_mv.data + __pyx_t_18 * __pyx_v_cutpoints_mv.strides[0]) ) + __pyx_t_17 * __pyx_v_cutpoints_mv.strides[1]) )) = __pyx_v_mz;
</pre><pre class="cython line score-0">&#xA0;<span class="">198</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">199</span>:                             <span class="k">if</span> <span class="n">append_indices</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                  __pyx_t_1 = (__pyx_v_append_indices != 0);
                  if (__pyx_t_1) {
/* … */
                  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">200</span>:                                 <span class="n">cutpoints_mv</span><span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="mf">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">i</span></pre>
<pre class='cython code score-0 '>                    __pyx_t_17 = __pyx_v_ic;
                    __pyx_t_18 = 4;
                    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_cutpoints_mv.data + __pyx_t_17 * __pyx_v_cutpoints_mv.strides[0]) ) + __pyx_t_18 * __pyx_v_cutpoints_mv.strides[1]) )) = ((double)__pyx_v_i);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">201</span>:                                 <span class="n">cutpoints_mv</span><span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="mf">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">j</span></pre>
<pre class='cython code score-0 '>                    __pyx_t_18 = __pyx_v_ic;
                    __pyx_t_17 = 5;
                    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_cutpoints_mv.data + __pyx_t_18 * __pyx_v_cutpoints_mv.strides[0]) ) + __pyx_t_17 * __pyx_v_cutpoints_mv.strides[1]) )) = ((double)__pyx_v_j);
</pre><pre class="cython line score-0">&#xA0;<span class="">202</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>:                             <span class="n">ic</span> <span class="o">=</span> <span class="n">ic</span> <span class="o">+</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>                  __pyx_v_ic = (__pyx_v_ic + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">204</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">205</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>:     <span class="c"># Truncate the cutpoints which were not written</span></pre>
<pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">207</span>:     <span class="n">cutpoints_truncated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cutpoints</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="n">ic</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="mf">0</span><span class="p">)</span></pre>
<pre class='cython code score-56 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_delete);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_ic);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_2, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_21 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      __pyx_t_21 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
    PyObject *__pyx_temp[4] = {__pyx_t_2, __pyx_v_cutpoints, __pyx_t_4, __pyx_int_0};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_21, 3+__pyx_t_21);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
    PyObject *__pyx_temp[4] = {__pyx_t_2, __pyx_v_cutpoints, __pyx_t_4, __pyx_int_0};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_21, 3+__pyx_t_21);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_22 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_21);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    if (__pyx_t_2) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0, __pyx_t_2); __pyx_t_2 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_cutpoints);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_cutpoints);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0+__pyx_t_21, __pyx_v_cutpoints);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 1+__pyx_t_21, __pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 2+__pyx_t_21, __pyx_int_0);
    __pyx_t_4 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_22, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 207, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_cutpoints_truncated = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">208</span>:     <span class="k">del</span><span class="p">(</span><span class="n">cutpoints</span><span class="p">)</span></pre>
<pre class='cython code score-1 '>  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_cutpoints);
  __pyx_v_cutpoints = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">209</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">210</span>:     <span class="c"># Sort rows based on time (column 0)</span></pre>
<pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">211</span>:     <span class="n">cutpoints_truncated</span> <span class="o">=</span> <span class="n">cutpoints_truncated</span><span class="p">[</span><span class="n">cutpoints_truncated</span><span class="p">[:,</span> <span class="mf">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span></pre>
<pre class='cython code score-35 '>  __pyx_slice_ = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice_)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_cutpoints_truncated, __pyx_tuple__2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_argsort);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_22))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_22);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_22);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_22, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_22, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_22);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
  __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_cutpoints_truncated, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_cutpoints_truncated, __pyx_t_22);
  __pyx_t_22 = 0;
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_slice_, __pyx_int_0);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 211, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-0">&#xA0;<span class="">212</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>:     <span class="k">return</span> <span class="n">cutpoints_truncated</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_cutpoints_truncated);
  __pyx_r = __pyx_v_cutpoints_truncated;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">214</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">216</span>: </pre>
</div></body></html>
