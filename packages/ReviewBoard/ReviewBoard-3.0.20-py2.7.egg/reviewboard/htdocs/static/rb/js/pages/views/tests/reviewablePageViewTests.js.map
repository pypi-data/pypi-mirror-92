{"version":3,"sources":["reviewablePageViewTests.es6.js"],"names":[],"mappings":";;AAAA,MAAM,mCAAN,EAA2C,YAAW;AAClD,QAAM,4IAAN;;AAMA,QAAI,oBAAJ;AACA,QAAI,gBAAJ;AACA,QAAI,aAAJ;AACA,QAAI,iBAAJ;;AAEA,eAAW,YAAW;AAClB,YAAM,aAAa,EAAE,QAAF,EACd,IADc,CACT,YADS,EAEd,QAFc,CAEL,aAFK,CAAnB;;AAIA,WAAG,WAAH,CAAe,QAAf,GAA0B,IAA1B;;AAEA,sBAAc,WAAW,IAAX,CAAgB,gBAAhB,CAAd;AACA,kBAAU,WAAW,IAAX,CAAgB,iBAAhB,CAAV;;AAEA,eAAO,IAAI,GAAG,cAAP,CAAsB;AACzB,6BAAiB,KADQ;AAEzB,+BAAmB;AACf,oBAAI,GADW;AAEf,wBAAQ,IAFO;AAGf,uBAAO,GAAG,aAAH,CAAiB;AAHT,aAFM;AAOzB,wBAAY;AACR,+BAAe,IADP;AAER,qCAAqB;AAFb;AAPa,SAAtB,EAWJ;AACC,mBAAO;AADR,SAXI,CAAP;;AAeA,mBAAW,IAAI,GAAG,kBAAP,CAA0B;AACjC,gBAAI,UAD6B;AAEjC,mBAAO;AAF0B,SAA1B,CAAX;;AAKA,YAAM,gBAAgB,KAAK,GAAL,CAAS,eAAT,CAAtB;;AAEA,cAAM,aAAN,EAAqB,OAArB,EAA8B,GAA9B,CAAkC,QAAlC,CACI,UAAC,OAAD,EAAU,OAAV;AAAA,mBAAsB,QAAQ,KAAR,CAAc,IAAd,CAAmB,OAAnB,CAAtB;AAAA,SADJ;;AAGA,iBAAS,MAAT;AACH,KApCD;;AAsCA,cAAU,YAAW;AACjB,WAAG,WAAH,CAAe,QAAf,GAA0B,IAA1B;;AAEA,iBAAS,MAAT;AACH,KAJD;;AAMA,aAAS,gBAAT,EAA2B,YAAW;AAClC,WAAG,eAAH,EAAoB,YAAW;AAC3B,mBAAO,KAAK,GAAL,CAAS,eAAT,CAAP,EAAkC,GAAlC,CAAsC,IAAtC,CAA2C,SAA3C;AACH,SAFD;;AAIA,WAAG,eAAH,EAAoB,YAAW;AAC3B,gBAAM,gBAAgB,KAAK,GAAL,CAAS,eAAT,CAAtB;;AAEA,mBAAO,aAAP,EAAsB,GAAtB,CAA0B,IAA1B,CAA+B,SAA/B;AACA,mBAAO,cAAc,GAAd,CAAkB,cAAlB,CAAP,EACK,IADL,CACU,KAAK,GAAL,CAAS,eAAT,CADV;AAEH,SAND;;AAQA,WAAG,qBAAH,EAA0B,YAAW;AACjC,mBAAO,KAAK,mBAAZ,EAAiC,GAAjC,CAAqC,IAArC,CAA0C,SAA1C;AACA,mBAAO,KAAK,mBAAL,CAAyB,GAAzB,CAA6B,eAA7B,CAAP,EACK,IADL,CACU,KAAK,GAAL,CAAS,eAAT,CADV;AAEH,SAJD;;AAMA,WAAG,qBAAH,EAA0B,YAAW;AACjC,gBAAM,sBAAsB,KAAK,mBAAjC;;AAEA,mBAAO,mBAAP,EAA4B,GAA5B,CAAgC,IAAhC,CAAqC,SAArC;AACA,mBAAO,oBAAoB,GAApB,CAAwB,eAAxB,CAAP,EACK,IADL,CACU,KAAK,GAAL,CAAS,eAAT,CADV;AAEA,mBAAO,oBAAoB,GAApB,CAAwB,qBAAxB,CAAP,EACK,IADL,CACU,KAAK,mBADf;AAEA,mBAAO,oBAAoB,GAApB,CAAwB,UAAxB,CAAP,EAA4C,IAA5C,CAAiD,IAAjD;AACH,SATD;;AAWA,WAAG,yBAAH,EAA8B,YAAW;AACrC,mBAAO,SAAS,uBAAhB,EAAyC,GAAzC,CAA6C,IAA7C,CAAkD,SAAlD;AACA,mBAAO,SAAS,uBAAT,CAAiC,KAAxC,EACK,IADL,CACU,KAAK,mBADf;AAEH,SAJD;AAKH,KAnCD;;AAqCA,aAAS,SAAT,EAAoB,YAAW;AAC3B,WAAG,aAAH,EAAkB,YAAW;AACzB,kBAAM,GAAG,gBAAT,EAA2B,QAA3B;;AAEA,wBAAY,KAAZ;;AAEA,mBAAO,GAAG,gBAAH,CAAoB,MAA3B,EAAmC,gBAAnC;;AAEA,gBAAM,UAAU,GAAG,gBAAH,CAAoB,MAApB,CAA2B,KAA3B,CAAiC,OAAjC,CAAyC,CAAzC,EAA4C,CAA5C,CAAhB;AACA,mBAAO,QAAQ,MAAf,EAAuB,IAAvB,CAA4B,KAAK,GAAL,CAAS,eAAT,CAA5B;AACA,mBAAO,QAAQ,mBAAf,EAAoC,IAApC,CAAyC,KAAK,mBAA9C;AACH,SAVD;;AAYA,iBAAS,SAAT,EAAoB,YAAW;AAC3B,gBAAI,sBAAJ;;AAEA,uBAAW,YAAW;AAClB,gCAAgB,KAAK,GAAL,CAAS,eAAT,CAAhB;AACH,aAFD;;AAIA,eAAG,WAAH,EAAgB,YAAW;AACvB,sBAAM,MAAN,EAAc,SAAd,EAAyB,GAAzB,CAA6B,WAA7B,CAAyC,IAAzC;AACA,sBAAM,aAAN,EAAqB,OAArB,EAA8B,GAA9B,CAAkC,QAAlC,CACI,UAAC,OAAD,EAAU,OAAV;AAAA,2BAAsB,QAAQ,KAAR,CAAc,IAAd,CAAmB,OAAnB,CAAtB;AAAA,iBADJ;AAEA,sBAAM,aAAN,EAAqB,MAArB,EAA6B,GAA7B,CAAiC,QAAjC,CACI,UAAC,OAAD,EAAU,OAAV;AAAA,2BAAsB,QAAQ,OAAR,CAAgB,IAAhB,CAAqB,OAArB,CAAtB;AAAA,iBADJ;AAEA,sBAAM,aAAN,EAAqB,SAArB,EAAgC,GAAhC,CAAoC,WAApC;AACA,sBAAM,SAAS,iBAAf,EAAkC,eAAlC;;AAEA,wBAAQ,KAAR;;AAEA,uBAAO,OAAO,OAAd,EAAuB,gBAAvB;AACA,uBAAO,cAAc,KAArB,EAA4B,gBAA5B;AACA,uBAAO,cAAc,OAArB,EAA8B,gBAA9B;AACA,uBAAO,cAAc,IAArB,EAA2B,gBAA3B;AACA,uBAAO,SAAS,iBAAT,CAA2B,aAAlC,EACK,gBADL;AAEA,uBAAO,cAAc,GAAd,CAAkB,QAAlB,CAAP,EAAoC,IAApC,CAAyC,IAAzC;AACA,uBAAO,cAAc,GAAd,CAAkB,SAAlB,CAAP,EAAqC,IAArC,CAA0C,UAA1C;AACH,aAnBD;;AAqBA,eAAG,UAAH,EAAe,YAAW;AACtB,sBAAM,MAAN,EAAc,SAAd,EAAyB,GAAzB,CAA6B,WAA7B,CAAyC,KAAzC;AACA,sBAAM,aAAN,EAAqB,OAArB;;AAEA,wBAAQ,KAAR;;AAEA,uBAAO,OAAO,OAAd,EAAuB,gBAAvB;AACA,uBAAO,cAAc,KAArB,EAA4B,GAA5B,CAAgC,gBAAhC;AACH,aARD;AASH,SArCD;AAsCH,KAnDD;;AAqDA,aAAS,eAAT,EAA0B,YAAW;AACjC,YAAM,UAAU,YAAhB;AACA,YAAM,OAAO;AACT,iBAAK,aADI;AAET,sBAAU,UAFD;AAGT,sBAAU;AAHD,SAAb;AAKA,YAAI,gBAAJ;AACA,YAAI,mBAAJ;;AAEA,mBAAW,YAAW;AAClB,iBAAK,GAAL,CAAS,eAAT,EAA0B,OAA1B,CAAkC,SAAlC,EAA6C;AACzC,yBAAS,OADgC;AAEzC,sBAAM;AAFmC,aAA7C;;AAKA,sBAAU,EAAE,iBAAF,CAAV;AACA,yBAAa,SAAS,cAAtB;AACH,SARD;;AAUA,WAAG,UAAH,EAAe,YAAW;AACtB,mBAAO,QAAQ,MAAf,EAAuB,IAAvB,CAA4B,CAA5B;AACA,mBAAO,WAAW,GAAX,CAAe,CAAf,CAAP,EAA0B,IAA1B,CAA+B,QAAQ,CAAR,CAA/B;AACA,mBAAO,QAAQ,EAAR,CAAW,UAAX,CAAP,EAA+B,IAA/B,CAAoC,IAApC;AACA,mBAAO,QAAQ,IAAR,CAAa,yBAAb,EAAwC,IAAxC,EAAP,EACK,IADL,CACU,OADV;AAEA,mBAAO,QAAQ,IAAR,CAAa,sBAAb,EAAqC,IAArC,EAAP,EACK,IADL,CACU,KAAK,QADf;AAEA,mBAAO,QAAQ,IAAR,CAAa,sBAAb,EAAqC,IAArC,CAA0C,MAA1C,CAAP,EACK,IADL,CACU,KAAK,GADf;AAEH,SAVD;;AAYA,iBAAS,SAAT,EAAoB,YAAW;AAC3B,eAAG,QAAH,EAAa,YAAW;AACpB,sBAAM,UAAN,EAAkB,OAAlB,EAA2B,GAA3B,CAA+B,WAA/B;AACA,sBAAM,UAAN,EAAkB,SAAlB,EAA6B,GAA7B,CAAiC,WAAjC;AACA,sBAAM,UAAN,EAAkB,QAAlB,EAA4B,GAA5B,CAAgC,WAAhC;;AAEA,wBAAQ,IAAR,CAAa,SAAb,EAAwB,KAAxB;;AAEA,uBAAO,WAAW,KAAlB,EAAyB,gBAAzB;AACA,uBAAO,WAAW,MAAlB,EAA0B,gBAA1B;AACA,uBAAO,WAAW,OAAlB,EAA2B,oBAA3B,CAAgD,QAAhD;AACH,aAVD;;AAYA,eAAG,qCAAH,EAA0C,YAAW;AACjD,sBAAM,UAAN,EAAkB,SAAlB;;AAEA,wBAAQ,IAAR,CAAa,cAAb,EAA6B,KAA7B;;AAEA,uBAAO,WAAW,OAAlB,EAA2B,oBAA3B,CAAgD,YAAhD;AACH,aAND;;AAQA,eAAG,0CAAH,EAA+C,YAAW;AACtD,oBAAM,OAAO;AACT,0BAAM;AACF,kCAAU;AADR;AADG,iBAAb;;AAMA,mBAAG,mBAAH,CAAuB,QAAvB,CAAgC,UAAhC,GAA6C,IAA7C;AACA,sBAAM,GAAG,mBAAH,CAAuB,QAA7B,EAAuC,QAAvC;AACA,sBAAM,GAAG,mBAAH,CAAuB,QAA7B,EACM,8BADN,EACsC,GADtC,CAC0C,WAD1C,CACsD,IADtD;AAEA,sBAAM,QAAN,EAAgB,oBAAhB;;AAEA,yBAAS,uBAAT,CAAiC,IAAjC;;AAEA,uBAAO,GAAG,mBAAH,CAAuB,QAAvB,CAAgC,MAAvC,EACK,gBADL;AAEA,uBAAO,SAAS,kBAAhB,EAAoC,gBAApC;AACH,aAlBD;AAmBH,SAxCD;AAyCH,KAzED;AA0EH,CA5ND","file":"reviewablePageViewTests.js","sourcesContent":["suite('rb/pages/views/ReviewablePageView', function() {\n    const pageTemplate = dedent`\n        <div id=\"review-banner\"></div>\n        <a href=\"#\" id=\"review-action\">Edit Review</a>\n        <a href=\"#\" id=\"ship-it-action\">Ship It</a>\n    `;\n\n    let $editReview;\n    let $shipIt;\n    let page;\n    let pageView;\n\n    beforeEach(function() {\n        const $container = $('<div/>')\n            .html(pageTemplate)\n            .appendTo($testsScratch);\n\n        RB.DnDUploader.instance = null;\n\n        $editReview = $container.find('#review-action');\n        $shipIt = $container.find('#ship-it-action');\n\n        page = new RB.ReviewablePage({\n            checkForUpdates: false,\n            reviewRequestData: {\n                id: 123,\n                loaded: true,\n                state: RB.ReviewRequest.PENDING,\n            },\n            editorData: {\n                mutableByUser: true,\n                statusMutableByUser: true,\n            },\n        }, {\n            parse: true,\n        });\n\n        pageView = new RB.ReviewablePageView({\n            el: $container,\n            model: page,\n        });\n\n        const reviewRequest = page.get('reviewRequest');\n\n        spyOn(reviewRequest, 'ready').and.callFake(\n            (options, context) => options.ready.call(context));\n\n        pageView.render();\n    });\n\n    afterEach(function() {\n        RB.DnDUploader.instance = null;\n\n        pageView.remove();\n    });\n\n    describe('Public objects', function() {\n        it('reviewRequest', function() {\n            expect(page.get('reviewRequest')).not.toBe(undefined);\n        });\n\n        it('pendingReview', function() {\n            const pendingReview = page.get('pendingReview');\n\n            expect(pendingReview).not.toBe(undefined);\n            expect(pendingReview.get('parentObject'))\n                .toBe(page.get('reviewRequest'));\n        });\n\n        it('commentIssueManager', function() {\n            expect(page.commentIssueManager).not.toBe(undefined);\n            expect(page.commentIssueManager.get('reviewRequest'))\n                .toBe(page.get('reviewRequest'));\n        });\n\n        it('reviewRequestEditor', function() {\n            const reviewRequestEditor = page.reviewRequestEditor;\n\n            expect(reviewRequestEditor).not.toBe(undefined);\n            expect(reviewRequestEditor.get('reviewRequest'))\n                .toBe(page.get('reviewRequest'));\n            expect(reviewRequestEditor.get('commentIssueManager'))\n                .toBe(page.commentIssueManager);\n            expect(reviewRequestEditor.get('editable')).toBe(true);\n        });\n\n        it('reviewRequestEditorView', function() {\n            expect(pageView.reviewRequestEditorView).not.toBe(undefined);\n            expect(pageView.reviewRequestEditorView.model)\n                .toBe(page.reviewRequestEditor);\n        });\n    });\n\n    describe('Actions', function() {\n        it('Edit Review', function() {\n            spyOn(RB.ReviewDialogView, 'create');\n\n            $editReview.click();\n\n            expect(RB.ReviewDialogView.create).toHaveBeenCalled();\n\n            const options = RB.ReviewDialogView.create.calls.argsFor(0)[0];\n            expect(options.review).toBe(page.get('pendingReview'));\n            expect(options.reviewRequestEditor).toBe(page.reviewRequestEditor);\n        });\n\n        describe('Ship It', function() {\n            let pendingReview;\n\n            beforeEach(function() {\n                pendingReview = page.get('pendingReview');\n            });\n\n            it('Confirmed', function() {\n                spyOn(window, 'confirm').and.returnValue(true);\n                spyOn(pendingReview, 'ready').and.callFake(\n                    (options, context) => options.ready.call(context));\n                spyOn(pendingReview, 'save').and.callFake(\n                    (options, context) => options.success.call(context));\n                spyOn(pendingReview, 'publish').and.callThrough();\n                spyOn(pageView.draftReviewBanner, 'hideAndReload');\n\n                $shipIt.click();\n\n                expect(window.confirm).toHaveBeenCalled();\n                expect(pendingReview.ready).toHaveBeenCalled();\n                expect(pendingReview.publish).toHaveBeenCalled();\n                expect(pendingReview.save).toHaveBeenCalled();\n                expect(pageView.draftReviewBanner.hideAndReload)\n                    .toHaveBeenCalled();\n                expect(pendingReview.get('shipIt')).toBe(true);\n                expect(pendingReview.get('bodyTop')).toBe('Ship It!');\n            });\n\n            it('Canceled', function() {\n                spyOn(window, 'confirm').and.returnValue(false);\n                spyOn(pendingReview, 'ready');\n\n                $shipIt.click();\n\n                expect(window.confirm).toHaveBeenCalled();\n                expect(pendingReview.ready).not.toHaveBeenCalled();\n            });\n        });\n    });\n\n    describe('Update bubble', function() {\n        const summary = 'My summary';\n        const user = {\n            url: '/users/foo/',\n            fullname: 'Mr. User',\n            username: 'user',\n        };\n        let $bubble;\n        let bubbleView;\n\n        beforeEach(function() {\n            page.get('reviewRequest').trigger('updated', {\n                summary: summary,\n                user: user,\n            });\n\n            $bubble = $('#updates-bubble');\n            bubbleView = pageView._updatesBubble;\n        });\n\n        it('Displays', function() {\n            expect($bubble.length).toBe(1);\n            expect(bubbleView.$el[0]).toBe($bubble[0]);\n            expect($bubble.is(':visible')).toBe(true);\n            expect($bubble.find('#updates-bubble-summary').text())\n                .toBe(summary);\n            expect($bubble.find('#updates-bubble-user').text())\n                .toBe(user.fullname);\n            expect($bubble.find('#updates-bubble-user').attr('href'))\n                .toBe(user.url);\n        });\n\n        describe('Actions', function() {\n            it('Ignore', function() {\n                spyOn(bubbleView, 'close').and.callThrough();\n                spyOn(bubbleView, 'trigger').and.callThrough();\n                spyOn(bubbleView, 'remove').and.callThrough();\n\n                $bubble.find('.ignore').click();\n\n                expect(bubbleView.close).toHaveBeenCalled();\n                expect(bubbleView.remove).toHaveBeenCalled();\n                expect(bubbleView.trigger).toHaveBeenCalledWith('closed');\n            });\n\n            it('Update Page displays Updates Bubble', function() {\n                spyOn(bubbleView, 'trigger');\n\n                $bubble.find('.update-page').click();\n\n                expect(bubbleView.trigger).toHaveBeenCalledWith('updatePage');\n            });\n\n            it('Update Page calls notify if shouldNotify', function() {\n                const info = {\n                    user: {\n                        fullname: 'Hello',\n                    },\n                };\n\n                RB.NotificationManager.instance._canNotify = true;\n                spyOn(RB.NotificationManager.instance, 'notify');\n                spyOn(RB.NotificationManager.instance,\n                      '_haveNotificationPermissions').and.returnValue(true);\n                spyOn(pageView, '_showUpdatesBubble');\n\n                pageView._onReviewRequestUpdated(info);\n\n                expect(RB.NotificationManager.instance.notify)\n                    .toHaveBeenCalled();\n                expect(pageView._showUpdatesBubble).toHaveBeenCalled();\n            });\n        });\n    });\n});\n"]}