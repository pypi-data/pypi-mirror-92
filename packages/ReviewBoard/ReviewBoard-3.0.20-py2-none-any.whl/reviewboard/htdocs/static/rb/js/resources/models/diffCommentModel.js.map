{"version":3,"sources":["diffCommentModel.es6.js"],"names":[],"mappings":"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","file":"diffCommentModel.js","sourcesContent":["/**\n * Provides commenting functionality for diffs.\n *\n * A DiffComment represents a comment on a range of lines on either a\n * FileDiff or an interdiff consisting of two FileDiffs.\n *\n * Model Attributes:\n *     beginLineNum (number):\n *         The first line number in the range (0-indexed).\n *\n *     endLineNum (number):\n *         The last line number in the range (0-indexed).\n *\n *     fileDiff (RB.FileDiff):\n *         The FileDiff that the comment applies to.\n *\n *     fileDiffID (number):\n *         The ID of the FileDiff that the comment applies to.\n *\n *     interFileDiff (RB.FileDiff):\n *         The FileDiff at the end of an interdiff range that the comment\n *         applies to, if appropriate.\n *\n *     interFileDiffID (number):\n *         The ID of the FileDiff at the end of an interdiff range that the\n *         comment applies to.\n */\nRB.DiffComment = RB.BaseComment.extend({\n    defaults: _.defaults({\n        beginLineNum: 0,\n        endLineNum: 0,\n        fileDiff: null,\n        fileDiffID: null,\n        interFileDiff: null,\n        interFileDiffID: null\n    }, RB.BaseComment.prototype.defaults()),\n\n    rspNamespace: 'diff_comment',\n    expandedFields: ['filediff', 'interfilediff'],\n\n    attrToJsonMap: _.defaults({\n        fileDiffID: 'filediff_id',\n        beginLineNum: 'first_line',\n        interFileDiffID: 'interfilediff_id',\n        numLines: 'num_lines'\n    }, RB.BaseComment.prototype.attrToJsonMap),\n\n    serializedAttrs: [\n        'beginLineNum',\n        'numLines',\n        'fileDiffID',\n        'interFileDiffID'\n    ].concat(RB.BaseComment.prototype.serializedAttrs),\n\n    deserializedAttrs: [\n        'beginLineNum',\n        'endLineNum'\n    ].concat(RB.BaseComment.prototype.deserializedAttrs),\n\n    serializers: _.defaults({\n        fileDiffID: RB.JSONSerializers.onlyIfUnloaded,\n        interFileDiffID: RB.JSONSerializers.onlyIfUnloadedAndValue,\n        numLines: function() {\n            return this.getNumLines();\n        }\n    }, RB.BaseComment.prototype.serializers),\n\n    /**\n     * Return the total number of lines the comment spans.\n     *\n     * Returns:\n     *     number:\n     *     The total number of lines for the comment.\n     */\n    getNumLines() {\n        return this.get('endLineNum') - this.get('beginLineNum') + 1;\n    },\n\n    /**\n     * Deserialize comment data from an API payload.\n     *\n     * Args:\n     *     rsp (object):\n     *         The data from the server.\n     *\n     * Returns:\n     *     object:\n     *     The model attributes to assign.\n     */\n    parseResourceData(rsp) {\n        const result = RB.BaseComment.prototype.parseResourceData.call(\n            this, rsp);\n\n        result.endLineNum = rsp.num_lines + result.beginLineNum - 1;\n\n        result.fileDiff = new RB.FileDiff(rsp.filediff, {\n            parse: true\n        });\n\n        if (rsp.interfilediff) {\n            result.interFileDiff = new RB.FileDiff(rsp.interfilediff, {\n                parse: true\n            });\n        }\n\n        return result;\n    },\n\n    /**\n     * Perform validation on the attributes of the model.\n     *\n     * This will check the range of line numbers to make sure they're\n     * a valid ordered range, along with the default comment validation.\n     *\n     * Args:\n     *     attrs (object):\n     *         The set of attributes to validate.\n     *\n     * Returns:\n     *     string:\n     *     An error string, if appropriate.\n     */\n    validate(attrs) {\n        /*\n         * XXX: Existing diff comments won't have the \"fileDiffID\" attribute\n         * populated when we load the object from the API. Since we don't do\n         * anything that needs that attribute unless we're trying to create a\n         * new diff comment, only check it if isNew().\n         */\n        if (this.isNew() && _.has(attrs, 'fileDiffID') && !attrs.fileDiffID) {\n            return RB.DiffComment.strings.INVALID_FILEDIFF_ID;\n        }\n\n        const hasBeginLineNum = _.has(attrs, 'beginLineNum');\n\n        if (hasBeginLineNum && attrs.beginLineNum < 0) {\n            return RB.DiffComment.strings.BEGINLINENUM_GTE_0;\n        }\n\n        const hasEndLineNum = _.has(attrs, 'endLineNum');\n\n        if (hasEndLineNum && attrs.endLineNum < 0) {\n            return RB.DiffComment.strings.ENDLINENUM_GTE_0;\n        }\n\n        if (hasBeginLineNum && hasEndLineNum &&\n            attrs.beginLineNum > attrs.endLineNum) {\n            return RB.DiffComment.strings.BEGINLINENUM_LTE_ENDLINENUM;\n        }\n\n        return RB.BaseComment.prototype.validate.apply(this, arguments);\n    }\n}, {\n    strings: {\n        INVALID_FILEDIFF_ID: 'fileDiffID must be a valid ID',\n        BEGINLINENUM_GTE_0: 'beginLineNum must be >= 0',\n        ENDLINENUM_GTE_0: 'endLineNum must be >= 0',\n        BEGINLINENUM_LTE_ENDLINENUM: 'beginLineNum must be <= endLineNum'\n    }\n});\n"]}