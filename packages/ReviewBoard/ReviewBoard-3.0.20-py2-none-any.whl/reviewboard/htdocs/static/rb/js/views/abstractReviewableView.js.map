{"version":3,"sources":["abstractReviewableView.es6.js"],"names":[],"mappings":"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","file":"abstractReviewableView.js","sourcesContent":["/**\n * Abstract base for review UIs.\n *\n * This provides all the basics for creating a review UI. It does the\n * work of loading in comments, creating views, and displaying comment dialogs,\n */\nRB.AbstractReviewableView = Backbone.View.extend({\n    /**\n     * The AbstractCommentBlockView subclass.\n     *\n     * This is the type that will be instantiated for rendering comment blocks.\n     */\n    commentBlockView: null,\n\n    /**\n     * The list type (as a string) for passing to CommentDlg.\n     */\n    commentsListName: null,\n\n    /**\n     * Initialize AbstractReviewableView.\n     *\n     * Args:\n     *     options (object, optional):\n     *         Options for the view.\n     */\n    initialize(options={}) {\n        console.assert(this.commentBlockView,\n                       'commentBlockView must be defined by the subclass');\n        console.assert(this.commentsListName,\n                       'commentsListName must be defined by the subclass');\n\n        this.commentDlg = null;\n        this._activeCommentBlock = null;\n        this.renderedInline = options.renderedInline || false;\n    },\n\n    /**\n     * Render the reviewable to the page.\n     *\n     * This will call the subclass's renderContent(), and then handle\n     * rendering each comment block on the reviewable.\n     *\n     * Returns:\n     *     RB.AbstractReviewableView:\n     *     This object, for chaining.\n     */\n    render() {\n        this.renderContent();\n\n        this.model.commentBlocks.each(this._addCommentBlockView, this);\n        this.model.commentBlocks.on('add', this._addCommentBlockView, this);\n\n        return this;\n    },\n\n    /**\n     * Render the content of the reviewable.\n     *\n     * This should be overridden by subclasses.\n     */\n    renderContent() {\n    },\n\n    /**\n     * Create a new comment in a comment block and opens it for editing.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the comment block creation.\n     */\n    createAndEditCommentBlock(options) {\n        if (this.commentDlg !== null &&\n            this.commentDlg.model.get('dirty') &&\n            !confirm(gettext('You are currently editing another comment. Would you like to discard it and create a new one?'))) {\n            return;\n        }\n\n        let defaultCommentBlockFields =\n            _.result(this.model, 'defaultCommentBlockFields');\n\n        if (defaultCommentBlockFields.length === 0 &&\n            this.model.reviewableIDField) {\n            console.log('Deprecation notice: Reviewable subclass is missing ' +\n                        'defaultCommentBlockFields. Rename reviewableIDField ' +\n                        'to defaultCommentBlockFields, and make it a list.');\n            defaultCommentBlockFields = [this.model.reviewableIDField];\n        }\n\n        /* As soon as we add the comment block, show the dialog. */\n        this.once('commentBlockViewAdded',\n                  commentBlockView => this.showCommentDlg(commentBlockView));\n\n        _.extend(options,\n                 _.pick(this.model.attributes, defaultCommentBlockFields));\n        this.model.createCommentBlock(options);\n    },\n\n    /**\n     * Show the comment details dialog for a comment block.\n     *\n     * Args:\n     *     commentBlockView (RB.AbstractCommentBlockView):\n     *         The comment block to show the dialog for.\n     */\n    showCommentDlg(commentBlockView) {\n        const commentBlock = commentBlockView.model;\n\n        commentBlock.ensureDraftComment();\n\n        if (this._activeCommentBlock === commentBlock) {\n            return;\n        }\n\n        this.stopListening(this.commentDlg, 'closed');\n        this.commentDlg = RB.CommentDialogView.create({\n            comment: commentBlock.get('draftComment'),\n            publishedComments: commentBlock.get('serializedComments'),\n            publishedCommentsType: this.commentsListName,\n            position: dlg => commentBlockView.positionCommentDlg(dlg),\n        });\n        this._activeCommentBlock = commentBlock;\n\n        this.listenTo(this.commentDlg, 'closed', () => {\n            this.commentDlg = null;\n            this._activeCommentBlock = null;\n        });\n    },\n\n    /**\n     * Add a CommentBlockView for the given CommentBlock.\n     *\n     * This will create a view for the block, render it, listen for clicks\n     * in order to show the comment dialog, and then emit\n     * 'commentBlockViewAdded'.\n     *\n     * Args:\n     *     commentBlock (RB.AbstractCommentBlock):\n     *         The comment block to add a view for.\n     */\n    _addCommentBlockView(commentBlock) {\n        const commentBlockView = new this.commentBlockView({\n            model: commentBlock\n        });\n\n        commentBlockView.on('clicked', () => this.showCommentDlg(commentBlockView));\n        commentBlockView.render();\n        this.trigger('commentBlockViewAdded', commentBlockView);\n    },\n});\n"]}