{"version":3,"sources":["linkifyUtils.es6.js"],"names":[],"mappings":"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","file":"linkifyUtils.js","sourcesContent":["RB.LinkifyUtils = {\n    URL_RE: new RegExp(\n        '\\\\b((' + [\n            'https://',\n            'http://',\n            'ftp://',\n            'ftps://',\n            'gopher://',\n            'mailto:',\n            'news:',\n            'sms:'\n        ].join('|') +\n        ')[\\\\-A-Za-z0-9+&@#\\/%?=~_()|!:,.;]*([\\\\-A-Za-z0-9+@#\\/%=~_();|]|))',\n        'g'\n    ),\n\n    /**\n     * Linkify all URLs within some text.\n     *\n     * This will turn things that look like URLs into clickable links.\n     *\n     * Args:\n     *     text (string):\n     *         The text to linkify.\n     *\n     * Returns:\n     *     string:\n     *     The given text with all URLs replaced by <a> tags.\n     */\n    linkifyURLs(text) {\n        return text.replace(\n            RB.LinkifyUtils.URL_RE,\n            function(url) {\n                /*\n                 * We might catch an entity at the end of the URL. This is hard\n                 * to avoid, since we can't rely on advanced RegExp techniques\n                 * in all browsers. So, we'll now search for it and prevent it\n                 * from being part of the URL if it exists. However, a URL with\n                 * an open bracket will not have its close bracket removed. This\n                 * was a modification to the original bug fix.\n                 *\n                 * See bug 1069.\n                 */\n                const parts = url.match(/^(.*)(&[a-z]+;|\\))$/);\n                const openParen = url.match(/.*\\(.*/);\n\n                let extra = '';\n\n                if (parts !== null && openParen === null) {\n                    /* We caught an entity. Set it free. */\n                    url = parts[1];\n                    extra = parts[2];\n                }\n\n                return `<a target=\"_blank\" href=\"${url}\">${url}</a>${extra}`;\n            });\n    },\n\n    /**\n     * Linkify /r/# review request numbers.\n     *\n     * This will turn things that look like references to other review requests\n     * into clickable links.\n     *\n     * Args:\n     *     text (string):\n     *         The text to linkify.\n     *\n     * Returns:\n     *     string:\n     *     The given text with all \"/r/#\" text replaced by <a> tags.\n     */\n    linkifyReviewRequests(text) {\n        return text.replace(\n            /(^|\\s|&lt;|\\(|\\[|{)\\/(r\\/\\d+(\\/[\\-A-Za-z0-9+&@#\\/%?=~_()|!:,.;]*[\\-A-Za-z0-9+&@#\\/%=~_()|]*)?)/g,\n            function(text, m1, m2) {\n                const parts = m2.match(/^(.*)(&[a-z]+;|\\))$/);\n\n                let extra = '';\n                let url = m2;\n\n                if (parts !== null) {\n                    /* We caught an entity. Set it free. */\n                    url = parts[1];\n                    extra = parts[2];\n                }\n\n                const href = SITE_ROOT + url + (url.substr(-1) === '/' ? '' : '/');\n\n                return `${m1}<a target=\"_blank\" href=\"${href}\" class=\"review-request-link\">/${url}</a>${extra}`;\n            });\n    },\n\n    /**\n     * Linkify bug numbers.\n     *\n     * This will turn things that look like references to bugs (such as\n     * \"bug 408\") into clickable links.\n     *\n     * Args:\n     *     text (string):\n     *         The text to linkify.\n     *\n     *     bugTrackerURL (string):\n     *         The URL to use when formatting the bug number. This is expected\n     *         to have the literal ``--bug_id--`` in it, which will be replaced\n     *         by the captured bug ID.\n     *\n     * Returns:\n     *     string:\n     *     The given text with all bug references replaced by <a> tags.\n     */\n    linkifyBugs(text, bugTrackerURL) {\n        if (bugTrackerURL) {\n            return text.replace(\n                /\\b(bug|issue) (#([^.,)\\]\\s]+)|#?(\\d+))/gi,\n                function(text, m2, m3, bugnum1, bugnum2) {\n                    /*\n                     * The bug number can appear in either of those groups,\n                     * depending on how this was typed, so try both.\n                     */\n                    const bugnum = bugnum1 || bugnum2;\n                    const href = bugTrackerURL.replace(\"--bug_id--\", bugnum);\n\n                    return `<a target=\"_blank\" href=\"${href}\">${text}</a>`;\n                });\n        } else {\n            return text;\n        }\n    },\n\n    /**\n     * Linkify text using all available methods.\n     *\n     * Linkifies a block of text, turning URLs, /r/#/ paths, and bug numbers\n     * into clickable links.\n     *\n     * Args:\n     *     text (string):\n     *         The text to linkify.\n     *\n     *     bugTrackerURL (string):\n     *         The URL to use when formatting the bug number. This is expected\n     *         to have the literal ``--bug_id--`` in it, which will be replaced\n     *         by the captured bug ID.\n     *\n     *     isHTMLEncoded (boolean):\n     *         Whether or not the given text has already had dangerous\n     *         characters (like < or >) replaced by their HTML entities. If\n     *         this is false, the text will first be encoded.\n     *\n     * Returns:\n     *     string:\n     *     The given text with all linkifyable items replaced by <a> tags.\n     */\n    linkifyText(text, bugTrackerURL, isHTMLEncoded) {\n        if (!isHTMLEncoded) {\n            text = text.htmlEncode();\n        }\n\n        text = RB.LinkifyUtils.linkifyURLs(text);\n        text = RB.LinkifyUtils.linkifyReviewRequests(text);\n        text = RB.LinkifyUtils.linkifyBugs(text, bugTrackerURL);\n        return text;\n    },\n\n    /**\n     * Linkify text within a pre-established DOM tree.\n     *\n     * This iterates through a tree of nodes, linkifying any text nodes that\n     * reference bug URLs, review requests, or contain unlinked plain-text\n     * URLs.\n     *\n     * This will avoid linking anything within a <pre> tag, to avoid messing\n     * with code blocks, and <a> tags, to avoid linkifying existing links.\n     *\n     * Args:\n     *     el (Element):\n     *         The element to linkify.\n     *\n     *     bugTrackerURL (string):\n     *         The URL to use when formatting the bug number. This is expected\n     *         to have the literal ``--bug_id--`` in it, which will be replaced\n     *         by the captured bug ID.\n     */\n    linkifyChildren(el, bugTrackerURL) {\n        for (let i = 0; i < el.childNodes.length; i++) {\n            const node = el.childNodes[i];\n\n            if (node.nodeType === node.TEXT_NODE) {\n                if (node.textContent) {\n                    const newText = RB.LinkifyUtils.linkifyText(\n                        node.textContent, bugTrackerURL);\n\n                    if (newText !== node.textContent) {\n                        $(node).replaceWith(newText);\n                    }\n                }\n            } else if (node.nodeType === node.ELEMENT_NODE) {\n                if (node.nodeName !== 'PRE' && node.nodeName !== 'A') {\n                    RB.LinkifyUtils.linkifyChildren(node, bugTrackerURL);\n                }\n            }\n        }\n    }\n};\n"]}