#!/usr/bin/python3
# OTP-CR-117/19 otp.informationdesk@icc-cpi.int http://genocide.rtfd.io
#
# this file is placed in the public domain

import os

servicetxt="""[Unit]
Description=OTP-CR-117/19 otp.informationdesk@icc-cpi.int http://genocide.rtfd.io
After=network-online.target

[Service]
DynamicUser=True
StateDirectory=genocide
LogsDirectory=genocide
CacheDirectory=genocide
ExecStart=/usr/local/bin/genocided
CapabilityBoundingSet=CAP_NET_RAW

[Install]
WantedBy=multi-user.target
"""

def run(txt, skip=["already"]):
    try:
        for line in os.popen(txt).readlines():
             print(line.rstrip())
    except Exception as ex:
        for rej in skip:
           if rej in str(ex):
               return

def postinstall():
    writeservice()
    run("systemctl enable genocide")
    run("systemctl daemon-reload")
    run("systemctl start genocide")
    run("systemctl status genocide")

def writeservice():
    p = "/etc/systemd/system/genocide.service"
    f = open(p, "w")
    f.write(servicetxt)
    f.close()

def read():
    return open("README.rst", "r").read()

postinstall()
