(self.webpackChunkjupyterlab_s3_browser=self.webpackChunkjupyterlab_s3_browser||[]).push([[568],{693:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.S3FileBrowser=void 0;const o=r(510),n=r(462),s=r(556),i=r(923),a=r(28);let c;class l extends o.Widget{constructor(e,t,r){super(),this.addClass("jp-S3Browser"),this.layout=new o.PanelLayout;const n=()=>{const t=document.querySelector("#s3form"),r=new FormData(t),o={};r.forEach(((e,t)=>{o[t]=e}));const n=s.ServerConnection.makeSettings();s.ServerConnection.makeRequest(i.URLExt.join(n.baseUrl,"s3/auth"),{method:"POST",body:JSON.stringify(o)},n).then((t=>{t.json().then((t=>{if(t.success)this.layout.removeWidget(c),this.layout.addWidget(e),e.model.refresh();else{let e=t.message;e.includes("InvalidAccessKeyId")?e="The access key ID you entered was invalid.":e.includes("SignatureDoesNotMatch")&&(e="The secret access key you entered was invalid"),a.showErrorMessage("S3 Authentication Error",Error(e))}}))}))};d.checkIfAuthenicated().then((t=>{console.log("Checking if authenticated"),t?(this.layout.addWidget(e),console.log("refreshing"),e.model.refresh()):(c=new o.Widget({node:d.createS3AuthenticationForm(n)}),this.layout.addWidget(c))}))}}var d;t.S3FileBrowser=l,function(e){e.createS3AuthenticationForm=function(e){return n.VirtualDOM.realize(n.h.div({className:"s3form"},n.h.h4("S3 Object Storage Browser"),n.h.div("This extension allows you to browse S3-compatible object storage instances, such as AWS S3 and IBM Cloud Object Storage."),n.h.br(),n.h.form({id:"s3form",method:"post"},n.h.p(n.h.label({},"Endpoint URL"),n.h.br(),n.h.input({type:"url",name:"endpoint_url"})),n.h.br(),n.h.p(n.h.label({},"Access Key ID"),n.h.br(),n.h.input({type:"text",name:"client_id"})),n.h.br(),n.h.p(n.h.label({},"Secret Access Key"),n.h.br(),n.h.input({type:"password",name:"client_secret"}))),n.h.br(),n.h.p({className:"s3-connect"},n.h.button({onclick:e,className:"jp-mod-accept jp-mod-styled"},"Connect"))))},e.checkIfAuthenicated=function(){return new Promise(((e,t)=>{const r=s.ServerConnection.makeSettings();s.ServerConnection.makeRequest(i.URLExt.join(r.baseUrl,"s3/auth"),{method:"GET"},r).then((t=>{t.json().then((t=>{e(t.authenticated)}))}))}))}}(d||(d={}))},630:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.S3Drive=void 0;const o=r(168),n=r(923),s=r(556),i=r(22);var a;t.S3Drive=class{constructor(e){this._isDisposed=!1,this._fileChanged=new o.Signal(this),this._registry=e}get name(){return"S3"}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,o.Signal.clearData(this))}get(e,t){return this.pathToJupyterContents(e)}getDownloadUrl(e){return console.log("not yet implemented"),Promise.reject("Not yet implemented")}newUntitled(e={}){return Promise.reject("Not yet implemented")}delete(e){return Promise.reject("Not yet implemented")}rename(e,t){return Promise.reject("Not yet implemented")}save(e,t){return Promise.reject("Not yet implemented")}copy(e,t){return Promise.reject("Not yet implemented")}createCheckpoint(e){return Promise.reject("Not yet implemented")}listCheckpoints(e){return Promise.resolve([])}restoreCheckpoint(e,t){return Promise.reject("Not yet implemented")}deleteCheckpoint(e,t){return Promise.reject("Read only")}jupyterPathToS3Path(e,t){return""===e?e="/":t&&(e+="/"),e}s3ToJupyterContents(e){return{name:e.name,path:e.path,format:"json",type:e.type,created:"",writable:!1,last_modified:"",mimetype:e.mimetype,content:e.content}}pathToJupyterContents(e){let t;return e!==a.currentPath&&"file"!==a.availableContentTypes[e]&&a.showingError&&a.hideErrorMessage(),"file"!==a.availableContentTypes[e]?(a.currentPath=e,t=this.jupyterPathToS3Path(e,!0)):t=this.jupyterPathToS3Path(e,!1),new Promise(((r,o)=>{let i=s.ServerConnection.makeSettings();s.ServerConnection.makeRequest(n.URLExt.join(i.baseUrl,"s3/files",t),{},i).then((t=>{t.json().then((t=>{if(t.error){let e=`Server returned status code ${t.error}. Error message: ${t.message}.`;return console.error(e),a.showErrorMessage(e),o(e),[]}if(Array.isArray(t))a.hideDirectoryLoadingSpinner(),a.availableContentTypes={},t.forEach((e=>{a.availableContentTypes[e.path]=e.type})),r({type:"directory",path:e.trim(),name:"",format:"json",content:t.map((e=>this.s3ToJupyterContents(e))),created:"",writable:!1,last_modified:"",mimetype:""});else{const o=this._registry.getFileTypesForPath(e),n=0===o.length?this._registry.getFileType("text"):o[0],s=n.mimeTypes[0],i=n.fileFormat;let c;switch(i){case"text":c=a.b64DecodeUTF8(t.content);break;case"base64":c=t.content;break;case"json":c=JSON.parse(a.b64DecodeUTF8(t.content));break;default:throw new Error(`Unexpected file format: ${n.fileFormat}`)}r({type:"file",path:e,name:"",format:i,content:c,created:"",writable:!1,last_modified:"",mimetype:s})}})).then((e=>(""===a.currentPath?document.querySelector("#s3-filebrowser").classList.add("root"):document.querySelector("#s3-filebrowser").classList.remove("root"),e)))}))}))}},function(e){const t=new TextDecoder("utf8");e.b64DecodeUTF8=function(e){const r=i.toByteArray(e.replace(/\n/g,""));return t.decode(r)},e.availableContentTypes={},e.showErrorMessage=function(t){e.hideDirectoryLoadingSpinner();let r=document.querySelector("#s3-filebrowser > .jp-DirListing");r.insertAdjacentHTML("afterend",`<div class="s3-error"><p>${t}</p></div>`),r.style.display="none",e.showingError=!0},e.showingError=!1,e.hideErrorMessage=function(){document.querySelector("#s3-filebrowser > .jp-DirListing").style.display="block",document.querySelector(".s3-error")&&document.querySelector(".s3-error").remove(),e.showingError=!1},e.showDirectoryLoadingSpinner=function(){if(console.log("showing loading spinner"),document.querySelector("#s3-spinner"))return;document.querySelector("#s3-filebrowser").classList.add("loading");let e=document.querySelector("#s3-filebrowser .jp-DirListing-content"),t=document.createElement("div");t.classList.add("jp-SpinnerContent"),t.id="s3-spinner",e.appendChild(t)},e.hideDirectoryLoadingSpinner=function(){console.log("trying to hide loading spinner");let e=document.querySelector("#s3-spinner");document.querySelector("#s3-filebrowser").classList.remove("loading");try{e.remove()}catch(e){console.log(e)}}}(a||(a={}))},568:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=r(213),n=r(129),s=r(832),i=r(537),a=r(630),c=r(693),l="s3-filebrowser",d={id:"jupyterlab-s3-browser:drive",requires:[s.IDocumentManager,i.IFileBrowserFactory,o.ILayoutRestorer,n.ISettingRegistry],activate:function(e,t,r,o,n){const s=new a.S3Drive(e.docRegistry);t.services.contents.addDrive(s);const i=r.createFileBrowser(l,{driveName:s.name,state:null,refreshInterval:3e5}),d=new c.S3FileBrowser(i,s,t);return d.title.iconClass="jp-S3-icon jp-SideBar-tabIcon",d.title.caption="Object Storage Browser",d.id="s3-file-browser",o.add(d,l),void e.shell.add(d,"left",{rank:100})},autoStart:!0};t.default=d}}]);