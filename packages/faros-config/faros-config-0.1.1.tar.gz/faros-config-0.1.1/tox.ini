[tox]
envlist = lint,security,js,test,report

[pytest]
testpaths = tests

[coverage:run]
source = src
parallel = True

[coverage:paths]
source =
   src/faros_config
   */site-packages/faros_config

[coverage:report]
show_missing = True

[testenv]
passenv =
    CI
    CODECOV_*
    GITHUB_*
allowlist_externals =
    rm

[testenv:lint]
deps =
    flake8
    flake8-docstrings
    flake8-pytest-style
commands =
    flake8 src/ --show-source --statistics

[testenv:security]
skip_install = True
deps =
    bandit
commands =
    bandit -r src/

[testenv:js]
skip_install = True
commands =
    {toxinidir}/scripts/js-env.sh \
        node_modules/patternfly/dist/js/patternfly.min.js \
        node_modules/patternfly/dist/css/patternfly.min.css \
        node_modules/patternfly/dist/css/patternfly-additions.min.css \
        node_modules/bootstrap/dist/js/bootstrap.min.js \
        node_modules/jquery/dist/jquery.min.js \
        node_modules/font-awesome/fonts/fontawesome-webfont.eot \
        node_modules/font-awesome/fonts/fontawesome-webfont.svg \
        node_modules/font-awesome/fonts/fontawesome-webfont.ttf \
        node_modules/font-awesome/fonts/fontawesome-webfont.woff \
        node_modules/font-awesome/fonts/fontawesome-webfont.woff2

[testenv:test]
deps =
    pytest
    pytest-cov
commands =
    python -m pytest --cov faros_config --cov-report=xml tests/

[testenv:report]
skip_install = True
deps =
    coverage
commands =
    coverage report # --fail-under=100  # disabled as aspirational

[testenv:build]
skip_install = True
basepython = python3
deps =
    setuptools
    wheel
commands =
    rm -rf dist
    python setup.py sdist bdist_wheel

[testenv:release]
skip_install = True
basepython = python3
deps =
    twine
passenv =
    TWINE_PASSWORD
    TWINE_REPOSITORY
setenv =
    TWINE_USERNAME = {env:TWINE_USERNAME:__token__}
commands =
    python -m twine upload --skip-existing dist/*
