"use strict";$(document).ready(function(){var r=null,l=null;$(".playButton").click(function(){var t=$("audio")[0];t.paused?t.play():t.pause()}),$("audio").on("play",function(){$(".playButton").removeClass("icon-play"),$(".playButton").addClass("icon-pause")}),$("audio").on("pause",function(){$(".playButton").removeClass("icon-pause"),$(".playButton").addClass("icon-play")}),$("audio").on("canplaythrough",function(t){var e=v($("audio")[0].duration);$(".audioControls .timeDisplay .totalTime").text(e),$(".audioControls .timeDisplay .progress").text("00:00")}),$("audio").on("error",function(t){$(".audioControls .timeDisplay .totalTime").text("--:--"),$(".audioControls .timeDisplay .progress").text("--:--")}),$("audio").on("timeupdate",function(t){var e=v($("audio")[0].currentTime);$(".audioControls .timeDisplay .progress").text(e)});var t,i=!1;$(".seekCursor").mousedown(function(t){i=!0}),$(window).mousemove(function(t){if(i){var e=$(".seekTrack").offset().left,a=($(".seekTrack").width(),t.pageX-e);a<0?$(".seekCursor").css("left",0):a>$(".seekTrack").width()?$(".seekCursor").css("left",$(".seekTrack").width()):$(".seekCursor").css("left",a)}}),$(window).mouseup(function(t){if(i){i=!1;var e=$(".seekCursor").css("left"),a=e.indexOf("px"),s=e.substring(0,a),n=parseFloat(s)/$(".seekTrack").width();$("audio")[0].currentTime=n*$("audio")[0].duration}}),$("audio").on("timeupdate",function(t){if(!i){var e=this.currentTime/this.duration*100;$(this).parent().find(".seekCursor").css("left",e+"%")}}),$(".speedButton").click(function(t){"none"===$(".speedSlider").css("display")?$(".speedSlider").css("display","block"):t.target!==$(".speedSlider")[0]&&$(".speedSlider").css("display","none")}),$(window).click(function(t){t.target!==$(".speedButton")[0]&&t.target!==$(".speedSlider")[0]&&$(".speedSlider").css("display","none")}),0<$("audio").length&&(t=$("audio")[0].playbackRate);var e=100-t/1.5*100;$(".speedCursor").css("top",e+"%");var a,d=!1;$(".speedCursor").mousedown(function(t){d=!0}),$(window).mousemove(function(t){if(d){var e=$(".speedTrack").offset().top,a=($(".speedTrack").height(),t.pageY-e);a<0?$(".speedCursor").css("top",0):a>$(".speedTrack").height()?$(".speedCursor").css("top",$(".speedTrack").height()):$(".speedCursor").css("top",a);var s=$(".speedCursor").css("top"),n=s.indexOf("px"),i=s.substring(0,n),o=parseFloat(i)/$(".speedTrack").height();$("audio")[0].playbackRate=1/(2*o)}}),$(window).mouseup(function(t){d=!1}),$(".volumeButton").click(function(t){"none"===$(".volumeSlider").css("display")?$(".volumeSlider").css("display","block"):t.target!==$(".volumeSlider")[0]&&$(".volumeSlider").css("display","none")}),$(window).click(function(t){t.target!==$(".volumeButton")[0]&&t.target!==$(".volumeSlider")[0]&&$(".volumeSlider").css("display","none")}),0<$("audio").length&&(a=$("audio")[0].playbackRate);e=100-100*a;$(".volumeCursor").css("top",e+"%");var c=!1;$(".volumeCursor").mousedown(function(t){c=!0}),$(window).mousemove(function(t){if(c){var e=$(".volumeTrack").offset().top,a=($(".volumeTrack").height(),t.pageY-e);a<0?$(".volumeCursor").css("top",0):a>$(".volumeTrack").height()?$(".volumeCursor").css("top",$(".volumeTrack").height()):$(".volumeCursor").css("top",a);var s=$(".volumeCursor").css("top"),n=s.indexOf("px"),i=s.substring(0,n),o=parseFloat(i)/$(".volumeTrack").height();$("audio")[0].volume=1-o}}),$(window).mouseup(function(t){c=!1}),$("#serifToggleButton").click(function(t){$("#transcriptionTextArea").hasClass("serif")?($("#transcriptionTextArea").removeClass("serif"),$("#serifToggleInput").val("false")):($("#transcriptionTextArea").addClass("serif"),$("#serifToggleInput").val("true")),$.post($("#serifToggleForm").attr("action"),$("#serifToggleForm").serialize())});var u=!1,p=null,m=null;function s(){$.post($("#resizeTranscriptionForm").attr("action"),$("#resizeTranscriptionForm").serialize())}$(".splitter").mousedown(function(t){u=!0,r=t.pageX,l=t.pageY,p=$(".task .transcript").height(),m=$(".task .transcript").width()}),$(window).mousemove(function(t){if(u)if($(".task").hasClass("stacked")){var e=t.pageY-l,a=p-e,s=$(".task").height()-21;s<a&&(a=s);var n=a.toString()+"px";stackedHeight=n,$(".task .transcript").css("height",n)}else{var i=t.pageX-r,o=(m-i).toString()+"px";unstackedWidth=o,$(".task .transcript").css("width",o)}}),$(window).mouseup(function(){u&&(function(){if($(".task").hasClass("stacked")){var t=$(".task .transcript").innerHeight().toString();$("#transcriptionHeight").val(t)}else{var e=$(".task .transcript").innerWidth().toString();$("#transcriptionWidth").val(e)}}(),s()),u=!1,m=p=l=r=null});$("#previousPageButton").click(function(){C(),taskEdit.currentPage=function(){var t=taskEdit.currentPage,e=taskEdit.pages.indexOf(t)-1;return e<0?t:taskEdit.pages[e]}(),k(),T()}),$("#currentPageButton").click(function(){C(),taskEdit.currentPage=taskEdit.editedPage,b(),T()}),$("#nextPageButton").click(function(){C(),taskEdit.currentPage=function(){var t=taskEdit.currentPage,e=taskEdit.pages.indexOf(t)+1;return e>=taskEdit.pages.length?t:taskEdit.pages[e]}(),k(),T()}),$(".notify > li.success").delay(4e3).fadeOut("slow"),$(".tasks li").click(function(t){t.preventDefault();var e=$(this).find(".title");if(t.target===e[0])window.location=e.attr("href");else{var a=$(this).find(".type").attr("href");window.location=a}}),0==$(".finishedTask").length&&0==$(".skippedTask").length&&$("#transcriptionTextArea").focus(),$("#transcriptionTextArea").bind("paste",function(t){t.preventDefault();var e=t.originalEvent.clipboardData.getData("text/plain");E(e=function(t){return $("<div>").text(t).html()}(e))});var n=!1;$(document).on("click keyup",function(t){17==(t.keyCode||t.which)&&(n=!1),g()}),$(document).on("keydown",function(t){var e=t.keyCode||t.which;if(17==e&&(n=!0),68==e&&1==n)return scrollDown(),!1;if(85==e&&1==n)return scrollUp(),!1;if(0!=$(".finishedTask").length||0!=$(".skippedTask").length);else if(83==e&&1==n)return h(),!1;return 75==e&&1==n?(function(){var t=B();t&&(t.paused?t.play():t.pause())}(),!1):74==e&&1==n?(function(t){var e=B();e&&(t=void 0!==t?t:5,e.currentTime=e.currentTime-t)}(),!1):76==e&&1==n?(function(t){var e=B();e&&(t=void 0!==t?t:5,e.currentTime=e.currentTime+t)}(),!1):void 0}),$("#transcriptionTextArea").on("keydown",function(t){var e=t.key||t.which;"Tab"==e?(t.preventDefault(),E("\t")):"Enter"==e&&(t.preventDefault(),-1==navigator.userAgent.indexOf("AppleWebKit")&&-1==navigator.userAgent.indexOf("MSIE")||"\n"!=$("#transcriptionTextArea").text().slice(-1)&&$("#transcriptionTextArea").append("\n"),-1!=navigator.userAgent.indexOf("AppleWebKit")&&x()&&$("#transcriptionTextArea").scrollTop($("#transcriptionTextArea")[0].scrollHeight),E("\n"),-1==navigator.userAgent.indexOf("AppleWebKit")&&x()&&$("#transcriptionTextArea").scrollTop($("#transcriptionTextArea")[0].scrollHeight))}),$("#transcribeForm #saveButton").click(function(t){return t.preventDefault(),h(),!1}),$("#transcribeForm #finishButton").click(function(t){if(0<$("#transcriptionTextArea span.opts").first().length)return t.preventDefault(),alert('Click the "apply diffs" button before submitting.'),!1;f()}),$("#transcribeForm #skipButton").click(function(t){f()});function o(){$("#transcribeForm").append($("<input type='hidden' />").attr({name:"status",id:"userTaskStatus",value:"in progress"}))}var f=function(){$("#transcribeForm").append($("<input type='hidden' />").attr({name:"transcription",id:"userTranscriptionFormInput",value:$("#transcriptionTextArea").html().replace("<br>","")}))},h=function(){$("#transcribeForm #saveButton").removeClass("saved"),$("#transcribeForm #saveButton").removeClass("failedToSave"),$("#transcribeForm #saveButton").addClass("saving"),f(),o(),$.post($("#transcribeForm").attr("action"),$("#transcribeForm").serialize()).done(function(t){"success"===t.status?(setTimeout(function(){$("#transcribeForm #saveButton").removeClass("saving")},500),$("#transcribeForm #saveButton").removeClass("failedToSave"),$("#transcribeForm #saveButton").addClass("saved")):(setTimeout(function(){$("#transcribeForm #saveButton").removeClass("saving")},500),$("#transcribeForm #saveButton").removeClass("saved"),$("#transcribeForm #saveButton").addClass("failedToSave"),alert("Error: Unable to save.")),$("#transcriptionTextArea").focus()}),$("#userTranscriptionFormInput").remove(),$("#userTaskStatus").remove()};$("a.saveTranscription").click(function(){return 0==$("#transcribeForm").length||(0!=$(".finishedTask").length||0!=$(".skippedTask").length||(f(),o(),h(),window.location=$(this).attr("href"),!1))}),$("a#toggle").click(function(){return!1}),0==$(".finishedTask").length&&0==$(".skippedTask").length||($("li.finishButton").hide(),$("li.skipButton").hide(),$("li.saveButton").hide()),$("a.reOpenUserTask").click(function(){return event.preventDefault(),$("li.finishButton").show(),$("li.skipButton").show(),$("li.saveButton").show(),$("div.notouch").remove(),$("#transcriptionTextArea").focus(),!1}),$("#toggleLayout").click(function(){return $(".task").hasClass("stacked")?$(".task").hasClass("stacked")&&($("#transcriptionStacked").val("false"),s(),$(".task").removeClass("stacked"),$(".task .transcript").css("height","100%"),$(".task .transcript").css("width",unstackedWidth)):($("#transcriptionStacked").val("true"),s(),$(".task").addClass("stacked"),$(".task .transcript").css("width","100%"),$(".task .transcript").css("height",stackedHeight)),!1}),"boolean"==typeof stacked&&(stacked?($(".task").addClass("stacked"),$("a#stacked").addClass("selected"),$("a#sidebyside").removeClass("selected"),$(".task .transcript").css("height",stackedHeight),$(".task .transcript").css("width","100%")):($(".task").removeClass("stacked"),$("a#stacked").removeClass("selected"),$("a#sidebyside").addClass("selected"),$(".task .transcript").css("height","100%"),$(".task .transcript").css("width",unstackedWidth))),$("span.opt").click(function(t){$(this).hide(0),$(this).addClass("optHidden"),0==$(this).next(".opt").length?($(this).siblings(".opt").first().removeClass("optHidden"),$(this).siblings(".opt").first().hide(0),$(this).siblings(".opt").first().fadeIn(250)):($(this).next(".opt").removeClass("optHidden"),$(this).next(".opt").hide(0),$(this).next(".opt").fadeIn(250)),$(this).siblings(".opt").first().css("display","inline")}),0<$("#transcriptionTextArea span.opts").first().length&&($(".tags button").hide(),$(".tags h3").hide(),$(".tags").append('<div id="diffInstructions"><p class="instructions">Click highlighted areas to choose diffs, or <a id="flipDiffs">flip all diffs</a>.</p><button id="applyDiffs">apply diffs</button></div>')),$("#flipDiffs").click(function(t){$("span.opts span.opt.optHidden").addClass("show"),$("span.opts span.opt").not(".optHidden").addClass("hide"),$("span.opts span.opt.show").css("display","inline"),$("span.opts span.opt.hide").css("display","none"),$("span.opts span.opt.show").removeClass("optHidden"),$("span.opts span.opt.show").removeClass("show"),$("span.opts span.opt.hide").addClass("optHidden"),$("span.opts span.opt.hide").removeClass("hide")}),$("button#applyDiffs").click(function(t){$(".optHidden").remove(),$(".optEmpty").remove(),$(".opt").contents().unwrap(),$(".opts").contents().unwrap(),$(".opts").remove(),$(".tags button").show(),$(".tags h2").show(),$("#diffInstructions").remove()});var g=function(){if(S("name","type","person")?$("button[buttonName='Person']").addClass("applied"):$("button[buttonName='Person']").removeClass("applied"),S("name","type","place")?$("button[buttonName='Place']").addClass("applied"):$("button[buttonName='Place']").removeClass("applied"),S("date")){$("button[buttonName='Date']").addClass("applied");var t=D(),e=$(t).closest("date").attr("when");$("button[buttonName='Date']").html("Date: "+e)}else $("button[buttonName='Date']").removeClass("applied"),$("button[buttonName='Date']").html("Date");S("TEIhead")?$("button[buttonName='Heading']").addClass("applied"):$("button[buttonName='Heading']").removeClass("applied"),S("q")?$("button[buttonName='Quote']").addClass("applied"):$("button[buttonName='Quote']").removeClass("applied"),S("add")?$("button[buttonName='Add']").addClass("applied"):$("button[buttonName='Add']").removeClass("applied"),S("del","rend","overstrike")?$("button[buttonName='Del']").addClass("applied"):$("button[buttonName='Del']").removeClass("applied"),S("note","place","margin")?$("button[buttonName='Note']").addClass("applied"):$("button[buttonName='Note']").removeClass("applied"),S("unclear","reason","illegible")?$("button[buttonName='Unclear']").addClass("applied"):$("button[buttonName='Unclear']").removeClass("applied"),S("hi","rend","underline")?$("button[buttonName='Underline']").addClass("applied"):$("button[buttonName='Underline']").removeClass("applied"),S("hi","rend","bold")?$("button[buttonName='Bold']").addClass("applied"):$("button[buttonName='Bold']").removeClass("applied"),S("hi","rend","italic")?$("button[buttonName='Italic']").addClass("applied"):$("button[buttonName='Italic']").removeClass("applied"),S("hi","rend","sup")?$("button[buttonName='Superscript']").addClass("applied"):$("button[buttonName='Superscript']").removeClass("applied"),S("hi","rend","sub")?$("button[buttonName='Subscript']").addClass("applied"):$("button[buttonName='Subscript']").removeClass("applied")};function v(t){var e=Math.floor(t/60).toString();1==e.length&&(e="0"+e);var a=Math.floor(t%60).toString();return 1==a.length&&(a="0"+a),e+":"+a}function k(){taskEdit.currentPage===taskEdit.editedPage?b():($("#transcriptDimmer").css("display","block"),$("#transcriptionTextArea").attr("contenteditable",!1))}function b(){$("#transcriptDimmer").css("display","none"),$("#transcriptionTextArea").attr("contenteditable",!0)}function C(){var t=taskEdit.currentPage;t.scrollLeft=$(t.figure).scrollLeft(),t.scrollTop=$(t.figure).scrollTop()}function T(){var t=taskEdit.currentPage;void 0===t.image?t.loadImage(function(){w(t.figure)}):t.figure!==$(".task .source figure").first()&&(w(t.figure),$(t.figure).scrollLeft(t.scrollLeft),$(t.figure).scrollTop(t.scrollTop))}function w(t){$(".task .source figure").first().remove(),$(".task .source").append(t)}$("button[class='insertTags']").click(function(t){t.preventDefault();if(!$(this).hasClass("applied")){var e=rangy.getSelection().toHtml();if(""==e)return!1;if("Person"==$(this).attr("buttonName")&&E('<name type="person">'+e+"</name>"),"Place"==$(this).attr("buttonName")&&E('<name type="place">'+e+"</name>"),"Date"==$(this).attr("buttonName")){var a=prompt("Enter a formatted date (YYYY-MM-DD):","YYYY-MM-DD");if(""===a||"YYYY-MM-DD"===a)return!1;E('<date when="'+a+'">'+e+"</date>")}"Heading"==$(this).attr("buttonName")&&E("<TEIhead>"+e+"</TEIhead>"),"Quote"==$(this).attr("buttonName")&&E("<q>"+e+"</q>"),"Add"==$(this).attr("buttonName")&&E("<add>"+e+"</add>"),"Del"==$(this).attr("buttonName")&&E('<del rend="overstrike">'+e+"</del>"),"Note"==$(this).attr("buttonName")&&E('<note place="margin">'+e+"</note>"),"Unclear"==$(this).attr("buttonName")&&E('<unclear reason="illegible">'+e+"</unclear>"),"Page #"==$(this).attr("buttonName")&&E('\n<pb n="'+e+'"/>'),"Underline"==$(this).attr("buttonName")&&E('<hi rend="underline">'+e+"</hi>"),"Bold"==$(this).attr("buttonName")&&E('<hi rend="bold">'+e+"</hi>"),"Italic"==$(this).attr("buttonName")&&E('<hi rend="italic">'+e+"</hi>"),"Superscript"==$(this).attr("buttonName")&&E('<hi rend="sup">'+e+"</hi>"),"Subscript"==$(this).attr("buttonName")&&E('<hi rend="sub">'+e+"</hi>")}}),$("button[class='insertTags']").click(function(t){if($(this).hasClass("applied")){var e=$(this).attr("buttonName"),a=D();switch(e){case"Person":a=$(a).closest("name[type='person']");break;case"Place":a=$(a).closest("name[type='place']");break;case"Date":a=$(a).closest("date");break;case"Heading":a=$(a).closest("TEIhead");break;case"Quote":a=$(a).closest("q");break;case"Add":a=$(a).closest("add");break;case"Del":a=$(a).closest("del[rend='overstrike']");break;case"Note":a=$(a).closest("note[place='margin']");break;case"Unclear":a=$(a).closest("unclear[reason='illegible']");break;case"Underline":a=$(a).closest("hi[rend='underline']");break;case"Bold":a=$(a).closest("hi[rend='bold']");break;case"Italic":a=$(a).closest("hi[rend='italic']");break;case"Superscript":a=$(a).closest("hi[rend='sup']");break;case"Subscript":a=$(a).closest("hi[rend='sub']");break;default:return!1}a&&$(a).contents().unwrap()}});var y={loadImage:function(t){var e=$(new Image);e.attr("draggable",!1),e.attr("src",this.url);var a=this;e.on("load",function(){$(a.figure).append(e),a.image=e,t()})}};if("undefined"!=typeof taskEdit)for(var N=0;N<taskEdit.pages.length;N++)Object.setPrototypeOf(taskEdit.pages[N],y);function x(){var t,e,a=$("#transcriptionTextArea").get(0),s=!1;if(window.getSelection){var n=window.getSelection();n.rangeCount&&((e=(t=n.getRangeAt(0)).cloneRange()).selectNodeContents(a),e.setEnd(t.startContainer,t.startOffset),""==e.toString(),e.selectNodeContents(a),e.setStart(t.endContainer,t.endOffset),s=""==e.toString()||"\n"==e.toString())}else document.selection&&"Control"!=document.selection.type&&((e=(t=document.selection.createRange()).duplicate()).moveToElementText(a),e.setEndPoint("EndToStart",t),""==e.text,e.moveToElementText(a),e.setEndPoint("StartToEnd",t),s=""==e.text||"\n"==e.text);return s}function S(t,e,a){var s=D();for(t=t.toUpperCase();s;){if(1==s.nodeType)if(void 0===e||void 0===a){if(s.tagName==t)return!0}else if(s.tagName==t&&s.attributes.getNamedItem(e).value==a)return!0;s=s.parentNode}return!1}function D(){return function(t){var e=t.commonAncestorContainer;3==e.nodeType&&(e=e.parentNode);return e}(rangy.getSelection().getRangeAt(0))}function E(t){var e,a;if(window.getSelection){if((e=window.getSelection()).getRangeAt&&e.rangeCount){(a=e.getRangeAt(0)).deleteContents();var s=document.createElement("div");s.innerHTML=t;for(var n,i,o=document.createDocumentFragment();n=s.firstChild;)i=o.appendChild(n);a.insertNode(o),i&&((a=a.cloneRange()).setStartAfter(i),a.collapse(!0),e.removeAllRanges(),e.addRange(a))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(t)}function B(){var t=!1;return document.getElementsByTagName("audio")[0]?t=document.getElementsByTagName("audio")[0]:document.getElementsByTagName("video")[0]&&(t=document.getElementsByTagName("video")[0]),t}});
//# sourceMappingURL=app.js.map