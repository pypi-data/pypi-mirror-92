beam, particle = proton, energy = 1;

k1_qs1f:=0.30902228/1.04;
k1_qs2d:=-0.52170131/1.04;
k1_qs3t:=0.315/0.4998000;

k2_S01KS1C=0.0;
k2_S01KS3C=0.0;
k2_S03KS1C=0.0;
k2_S03KS3C=0.0;
k2_S05KS1C=0.0;
k2_S05KS3C=0.0;
k2_S07KS1C=0.0;
k2_S07KS3C=0.0;
k2_S09KS1C=0.0;
k2_S09KS3C=0.0;
k2_S11KS1C=0.0;
k2_S11KS3C=0.0;

coh_kick1: hkicker, kick=0.0;
coh_kick2: hkicker, kick=0.0;
coh_kick3: hkicker, kick=0.0;
coh_kick4: hkicker, kick=0.0;
coh_kick5: hkicker, kick=0.0;
coh_kick6: hkicker, kick=0.0;
coh_kick7: hkicker, kick=0.0;
coh_kick8: hkicker, kick=0.0;
coh_kick9: hkicker, kick=0.0;
coh_kick10: hkicker, kick=0.0;
coh_kick11: hkicker, kick=0.0;
coh_kick12: hkicker, kick=0.0;

cov_kick1: vkicker, kick=0.0;
cov_kick2: vkicker, kick=0.0;
cov_kick3: vkicker, kick=0.0;
cov_kick4: vkicker, kick=0.0;
cov_kick5: vkicker, kick=0.0;
cov_kick6: vkicker, kick=0.0;
cov_kick7: vkicker, kick=0.0;
cov_kick8: vkicker, kick=0.0;
cov_kick9: vkicker, kick=0.0;
cov_kick10: vkicker, kick=0.0;
cov_kick11: vkicker, kick=0.0;
cov_kick12: vkicker, kick=0.0;

DRB1: DRIFT, L=0.6450000;
DRB2: DRIFT, L=0.9700000;
ALPHA := 15 * RADDEG;
LL    := 150 * RADDEG;
PFR   := 7.3 * RADDEG;
FI    := 0.7;
RB: SBEND,L= LL,ANGLE= ALPHA,E1= PFR,E2=PFR,HGAP=0.035,FINT=FI;
RB1: SBEND,L= LL/2.0,ANGLE= ALPHA/2.0,E1= PFR,E2=0.0,HGAP=0.035,FINT=FI;
RB2: SBEND,L= LL/2.0,ANGLE= ALPHA/2.0,E1= 0.0,E2=PFR,HGAP=0.035,FINT=FI;

RB11: SBEND,L= LL/4.0,ANGLE= ALPHA/4.0,E1=PFR,E2=0,HGAP=0.035,FINT=FI,fintx=1e-10; 
RB12: SBEND,L= LL/4.0,ANGLE= ALPHA/4.0,E1=0 ,E2=0,HGAP=0.035,FINT=1e-10;
RB21: SBEND,L= LL/4.0,ANGLE= ALPHA/4.0,E1=0,E2=0,HGAP=0.035,FINT=1e-10;
RB22: SBEND,L= LL/4.0,ANGLE= ALPHA/4.0,E1=0,E2=PFR,HGAP=0.035,FINT=1e-10, fintx=FI;

BENDSECT1: LINE=(DRB1,RB11,coh_kick1,RB12,RB21,RB22,DRB2,RB11,RB12,RB21,RB22);
BENDSECT2: LINE=(DRB1,RB11,coh_kick2,RB12,RB21,RB22,DRB2,RB11,RB12,RB21,RB22);
BENDSECT3: LINE=(DRB1,RB11,coh_kick3,RB12,RB21,RB22,DRB2,RB11,RB12,RB21,RB22);
BENDSECT4: LINE=(DRB1,RB11,RB12,RB21,RB22,DRB2,RB11,coh_kick4,RB12,RB21,RB22);
BENDSECT5: LINE=(DRB1,RB11,coh_kick5,RB12,RB21,RB22,DRB2,RB11,RB12,RB21,RB22);
BENDSECT6: LINE=(DRB1,RB11,RB12,RB21,RB22,DRB2,RB11,coh_kick6,RB12,RB21,RB22);
BENDSECT7: LINE=(DRB1,RB11,coh_kick7,RB12,RB21,RB22,DRB2,RB11,RB12,RB21,RB22);
BENDSECT8: LINE=(DRB1,RB11,coh_kick8,RB12,RB21,RB22,DRB2,RB11,RB12,RB21,RB22);
BENDSECT9: LINE=(DRB1,RB11,coh_kick9,RB12,RB21,RB22,DRB2,RB11,RB12,RB21,RB22);
BENDSECT10: LINE=(DRB1,RB11,coh_kick10,RB12,RB21,RB22,DRB2,RB11,RB12,RB21,RB22);
BENDSECT11: LINE=(DRB1,RB11,coh_kick11,RB12,RB21,RB22,DRB2,RB11,RB12,RB21,RB22);
BENDSECT12: LINE=(DRB1,RB11,coh_kick12,RB12,RB21,RB22,DRB2,RB11,RB12,RB21,RB22);

DR4: DRIFT, L=0.6000000;
QS1F: QUADRUPOLE, L=1.0400000 / 2, K1:= k1_qs1f;
QS1D: QUADRUPOLE, L=1.0400000 / 2, K1:= k1_qs2d;

DOUBLETSECT1: line=(QS1F,QS1F,DR4,cov_kick1,QS1D,QS1D);
DOUBLETSECT2: line=(QS1F,QS1F,DR4,cov_kick2,QS1D,QS1D);
DOUBLETSECT3: line=(QS1F,QS1F,DR4,cov_kick3,QS1D,QS1D);
DOUBLETSECT5: line=(QS1F,QS1F,DR4,cov_kick5,QS1D,QS1D);
DOUBLETSECT6: line=(QS1F,QS1F,DR4,cov_kick6,QS1D,QS1D);
DOUBLETSECT7: line=(QS1F,QS1F,DR4,cov_kick7,QS1D,QS1D);
DOUBLETSECT8: line=(QS1F,QS1F,DR4,cov_kick8,QS1D,QS1D);
DOUBLETSECT9: line=(QS1F,QS1F,DR4,cov_kick9,QS1D,QS1D);
DOUBLETSECT10: line=(QS1F,QS1F,DR4,cov_kick10,QS1D,QS1D);
DOUBLETSECT11: line=(QS1F,QS1F,DR4,cov_kick11,QS1D,QS1D);
DOUBLETSECT12: line=(QS1F,QS1F,DR4,cov_kick12,QS1D,QS1D);

DR6: DRIFT, L=0.4998000;
QS3T: QUADRUPOLE, L= 0.4804000, K1= k1_qs3t; 

LASTQUAD: line=(QS3T,DR6);

MH1: hmonitor, L=0;
MH2: hmonitor, L=0;
MH3: hmonitor, L=0;
MH4: hmonitor, L=0;
MH5: hmonitor, L=0;
MH6: hmonitor, L=0;
MH7: hmonitor, L=0;
MH8: hmonitor, L=0;
MH9: hmonitor, L=0;
MH10: hmonitor, L=0;
MH11: hmonitor, L=0;
MH12: hmonitor, L=0;

MV1: vmonitor, L=0;
MV2: vmonitor, L=0;
MV3: vmonitor, L=0;
MV4: vmonitor, L=0;
MV5: vmonitor, L=0;
MV6: vmonitor, L=0;
MV7: vmonitor, L=0;
MV8: vmonitor, L=0;
MV9: vmonitor, L=0;
MV10: vmonitor, L=0;
MV11: vmonitor, L=0;
MV12: vmonitor, L=0;

DR1P1M1: DRIFT, L=4.5640117 / 5;
DR1P1M2: DRIFT, L=1.9400000 / 2;
DR1P1M3: DRIFT, L=0.3350000;
S01KM3QS: multipole, ksl={0.0,0.0}; 
S01KS1C: multipole, knl={0.0,0.0,k2_S01KS1C};
SO1DM: multipole, knl={0.02,0.0,0};

MULT1SECT1: LINE=(DR1P1M1,DR1P1M1,DR1P1M1,DR1P1M1,DR1P1M1,S01KM3QS,DR1P1M2,DR1P1M2,S01KS1C,DR1P1M3);

DR1P2M1: DRIFT, L=0.3550000;
DR1P2M2: DRIFT, L=0.3548000;
S01KS3C: multipole, knl={0.0,0.0,k2_S01KS3C}; 

MULT2SECT1: LINE=(DR1P2M1,S01KS3C,DR1P2M2);

PERIOD1: LINE=(BENDSECT1,MULT1SECT1,DOUBLETSECT1,MULT2SECT1,LASTQUAD,MV1,MH1);

DR3: DRIFT,  L=6.8390117 / 7;

MULT1SECT2: LINE=(DR3,DR3,DR3,DR3,DR3,DR3,DR3);

S02KQ4:   MULTIPOLE,KNL={0.0,0.0};
S02KM3QS: multipole, ksl={0.0,0.0}; 
S02KM5SS: multipole, knl={0.0,0.0,0.0}; 

MULT2SECT2: LINE=(DR1P2M1,S02KQ4,S02KM3QS,S02KM5SS,DR1P2M2);

PERIOD2: LINE=(BENDSECT2,MULT1SECT2,DOUBLETSECT2,MULT2SECT2,LASTQUAD,MV2,MH2);

DR3P1M1: DRIFT,  L=6.5040117 / 7;
DR3P1M2: DRIFT,  L=0.3350000;
S03KS1C: multipole, knl={0.0,0.0,k2_S03KS1C}; 

MULT1SECT3: LINE=(DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,S03KS1C,DR3P1M2);

S03KS3C: multipole, knl={0.0,0.0,k2_S03KS3C};

MULT2SECT3: LINE=(DR1P2M1,S03KS3C,DR1P2M2);

PERIOD3: LINE=(BENDSECT3,MULT1SECT3,DOUBLETSECT3,MULT2SECT3,LASTQUAD,MV3,MH3);

last_drift: DRIFT, L=0.8350067;
S04ME1EE: DRIFT, L=0.75;
S04ME1E: MULTIPOLE, knl={0.0}; 
dr4p1m1: DRIFT, L=0.335;
dr0.09 : DRIFT, L=0.09;
dr0.49 : DRIFT, L=0.49;
dr0.658: DRIFT, L=0.658;
S04_tfx: multipole, knl={0.0}; 
S04_tfy: multipole, ksl={0.0}; 

MULT1SECT4: LINE=(DR3,DR3,DR3,last_drift);
MULT3SECT4: LINE=(dr0.658,s04_tfx,dr0.49,s04_tfy,dr0.09,dr4p1m1);

S04KQ4:   MULTIPOLE,KNL= {0.0,0.0};
S04KM3QS: multipole, ksl={0.0,0.0}; 

MULT2SECT4: LINE=(DR1P2M1,S04KQ4,S04KM3QS,DR1P2M2);

DR2: DRIFT, L=0.3000000;
co_kick1: hkicker, kick=0.0;
co_kick2: hkicker, kick=0.0;
co_kick3: hkicker, kick=0.0;

DOUBLETSECT4: line=(QS1F,QS1F,DR2,dr2,coV_kick4,QS1D,QS1D);

PERIOD4: LINE=(BENDSECT4,MULT1SECT4);
SEPTUM_PERIOD: LINE=(S04ME1EE,S04ME1E,S04ME1EE,MULT3SECT4,DOUBLETSECT4,MULT2SECT4,LASTQUAD,MV4,MH4);

S05KS1C: multipole, knl={0.0,0.0,k2_S05KS1C};

MULT1SECT5: LINE=(DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,S05KS1C,DR3P1M2);

S05KS3C: multipole, knl={0.0,0.0,k2_S05KS3C}; 
 
MULT2SECT5: LINE=(DR1P2M1,S05KS3C,DR1P2M2);

PERIOD5: LINE=(BENDSECT5,MULT1SECT5,DOUBLETSECT5,MULT2SECT5,LASTQUAD,MV5,MH5);

MULT1SECT6: LINE=(DR3,DR3,DR3,DR3,DR3,DR3,DR3);

S06KM3QS: multipole, ksl={0.0,0.0};

MULT2SECT6: LINE=(DR1P2M1,S06KM3QS,DR1P2M2);

PERIOD6: LINE=(BENDSECT6,MULT1SECT6,DOUBLETSECT6,MULT2SECT6,LASTQUAD,MV6,MH6);

DR7P1M1: DRIFT,  L=5.2640117 / 6;
DR7P1M2: DRIFT,  L=1.2400117 / 2;
DR7P1M3: DRIFT,  L=0.3350000;
S07KM3QS: multipole, ksl={0.0,0.0}; 
S07KS1C: multipole, knl={0.0,0.0,k2_S07KS1C}; 

MULT1SECT7: LINE=(DR7P1M1,DR7P1M1,DR7P1M1,DR7P1M1,DR7P1M1,DR7P1M1,S07KM3QS,DR7P1M2,DR7P1M2,S07KS1C,DR7P1M3);

S07KS3C: multipole, knl={0.0,0.0,k2_S07KS3C};

MULT2SECT7: LINE=(DR1P2M1,S07KS3C,DR1P2M2);

PERIOD7: LINE=(BENDSECT7,MULT1SECT7,DOUBLETSECT7,MULT2SECT7,LASTQUAD,MV7,MH7);

MULT1SECT8: LINE=(DR3,DR3,DR3,DR3,DR3,DR3,DR3);

S08KQ4:   MULTIPOLE,KNL= {0.0,0.0};
S08KM3QS: multipole, ksl={0.0,0.0}; 
S08KM5SS: multipole, knl={0.0,0.0,0.0}; 

MULT2SECT8: LINE=(DR1P2M1,S08KQ4,S08KM3QS,S08KM5SS,DR1P2M2);

PERIOD8: LINE=(BENDSECT8,MULT1SECT8,DOUBLETSECT8,MULT2SECT8,LASTQUAD,MV8,MH8);

S09KS1C: multipole, knl={0.0,0.0,k2_S09KS1C};
S09DRH: marker;
S09DRV: marker;
dr_drv: drift, l=4.4810117;
dr_drh: drift, l=0.958;
dr_fill: drift, l=1.065;

MULT1SECT9: LINE=(dr_fill,s09drh,dr_drh,s09drv,dr_drv,S09KS1C,DR3P1M2);

S09KS3C: multipole, knl={0.0,0.0,k2_S09KS3C};

MULT2SECT9: LINE=(DR1P2M1,S09KS3C,DR1P2M2);

PERIOD9: LINE=(BENDSECT9,MULT1SECT9,DOUBLETSECT9,MULT2SECT9,LASTQUAD,MV9,MH9);

MULT1SECT10: LINE=(DR3,DR3,DR3,DR3,DR3,DR3,DR3);

S10KQ4:   MULTIPOLE,KNL= {0.0,0.0};
S10KM3QS: multipole, ksl={0.0,0.0}; 

MULT2SECT10: LINE=(DR1P2M1,S10KQ4,S10KM3QS,DR1P2M2);

PERIOD10: LINE=(BENDSECT10,MULT1SECT10,DOUBLETSECT10,MULT2SECT10,LASTQUAD,MV10,MH10);

S11KS1C: multipole, knl={0.0,0.0,k2_S11KS1C};

MULT1SECT11: LINE=(DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,DR3P1M1,S11KS1C,DR3P1M2);

S11KS3C: multipole, knl={0.0,0.0,k2_S11KS3C};

MULT2SECT11: LINE=(DR1P2M1,S11KS3C,DR1P2M2);

PERIOD11: LINE=(BENDSECT11,MULT1SECT11,DOUBLETSECT11,MULT2SECT11,LASTQUAD,MV11,MH11);

MULT1SECT12: LINE=(DR3,DR3,DR3,DR3,DR3,DR3,DR3);

S12KM3QS: multipole, ksl={0.0,0.0};

MULT2SECT12: LINE=(DR1P2M1,S12KM3QS,DR1P2M2);

PERIOD12: LINE=(BENDSECT12,MULT1SECT12,DOUBLETSECT12,MULT2SECT12,LASTQUAD,MV12,MH12);


SIS18LATTICE: LINE=(SEPTUM_PERIOD,PERIOD5,PERIOD6,PERIOD7,PERIOD8,PERIOD9,
	PERIOD10,PERIOD11,PERIOD12,PERIOD1, PERIOD2, PERIOD3, PERIOD4);

USE, sequence=sis18lattice;
x=3;
er=0.3e-3;
er2=0.4e-3;
ng=0.5;

select, flag=error, pattern="QS1F.*";
Ealign, dx:=er2*tgauss(x), dy:=er*tgauss(x);

select, flag=error, pattern="QS1Fbb.*";
Ealign, dx:=er2*tgauss(x), dy:=er*tgauss(x);

select, flag=error, pattern="QS1D.*";
Ealign, dx:=er2*tgauss(x), dy:=er*tgauss(x);
